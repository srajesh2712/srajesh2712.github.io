<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Deep Dive: How Database Indexing Works (The B-Tree) | Beyond the Bytes</title>
<meta name="keywords" content="Databases, Performance, Computer Science">
<meta name="description" content="The Fundamental Problem: The Full Table Scan
Imagine a table with 10 million rows. To find a specific ID without an index, the database must perform a Full Table Scan—checking every single row from 1 to 10,000,000. This is $O(n)$ complexity.
Indexing transforms this into a &ldquo;search in a book&rdquo; experience using a data structure called a B-Tree.

1. What is an Index?
At its core, an index is a separate, sorted data structure that maps a specific value (like an ID or Name) to a Pointer (the physical address of the row on disk).">
<meta name="author" content="Rajesh Subramanian">
<link rel="canonical" href="http://localhost:1313/drafts/postgres-internals-and-visuals/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.45da07cc2f1287a2aed2f0e5d5f6a80a124756a1c1228703eebc30c546fb9f0e.css" integrity="sha256-RdoHzC8Sh6Ku0vDl1faoChJHVqHBIocD7rwwxUb7nw4=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/drafts/postgres-internals-and-visuals/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/drafts/postgres-internals-and-visuals/">
  <meta property="og:site_name" content="Beyond the Bytes">
  <meta property="og:title" content="Deep Dive: How Database Indexing Works (The B-Tree)">
  <meta property="og:description" content="The Fundamental Problem: The Full Table Scan Imagine a table with 10 million rows. To find a specific ID without an index, the database must perform a Full Table Scan—checking every single row from 1 to 10,000,000. This is $O(n)$ complexity.
Indexing transforms this into a “search in a book” experience using a data structure called a B-Tree.
1. What is an Index? At its core, an index is a separate, sorted data structure that maps a specific value (like an ID or Name) to a Pointer (the physical address of the row on disk).">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="drafts">
    <meta property="article:published_time" content="2026-02-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-02-25T00:00:00+00:00">
    <meta property="article:tag" content="Databases">
    <meta property="article:tag" content="Performance">
    <meta property="article:tag" content="Computer Science">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Deep Dive: How Database Indexing Works (The B-Tree)">
<meta name="twitter:description" content="The Fundamental Problem: The Full Table Scan
Imagine a table with 10 million rows. To find a specific ID without an index, the database must perform a Full Table Scan—checking every single row from 1 to 10,000,000. This is $O(n)$ complexity.
Indexing transforms this into a &ldquo;search in a book&rdquo; experience using a data structure called a B-Tree.

1. What is an Index?
At its core, an index is a separate, sorted data structure that maps a specific value (like an ID or Name) to a Pointer (the physical address of the row on disk).">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Drafts",
      "item": "http://localhost:1313/drafts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Deep Dive: How Database Indexing Works (The B-Tree)",
      "item": "http://localhost:1313/drafts/postgres-internals-and-visuals/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Deep Dive: How Database Indexing Works (The B-Tree)",
  "name": "Deep Dive: How Database Indexing Works (The B-Tree)",
  "description": "The Fundamental Problem: The Full Table Scan Imagine a table with 10 million rows. To find a specific ID without an index, the database must perform a Full Table Scan—checking every single row from 1 to 10,000,000. This is $O(n)$ complexity.\nIndexing transforms this into a \u0026ldquo;search in a book\u0026rdquo; experience using a data structure called a B-Tree.\n1. What is an Index? At its core, an index is a separate, sorted data structure that maps a specific value (like an ID or Name) to a Pointer (the physical address of the row on disk).\n",
  "keywords": [
    "Databases", "Performance", "Computer Science"
  ],
  "articleBody": "The Fundamental Problem: The Full Table Scan Imagine a table with 10 million rows. To find a specific ID without an index, the database must perform a Full Table Scan—checking every single row from 1 to 10,000,000. This is $O(n)$ complexity.\nIndexing transforms this into a “search in a book” experience using a data structure called a B-Tree.\n1. What is an Index? At its core, an index is a separate, sorted data structure that maps a specific value (like an ID or Name) to a Pointer (the physical address of the row on disk).\nThe “Pointer” Concept The Index Record: Lives in the index tree. It says: “Value 72 is at GPS Coordinate X.” The Pointer: A physical address (File ID, Page ID, Slot No.) that tells the database exactly where to go on the hard drive to grab the full row. 2. The Anatomy of a B-Tree A B-Tree (Balanced Tree) is a hierarchy of Pages. Instead of searching row-by-row, the database “jumps” through levels:\nRoot Node (The Starting Point): Contains broad ranges (e.g., “Values 1-100 go to Page A, 101-200 go to Page B”). Internal Nodes (The Navigators): Narrow the search further (e.g., “Values 51-75 go to Page C”). Leaf Nodes (The Destination): These contain the actual sorted values and their corresponding Pointers to the disk. Note: Leaf nodes are linked horizontally. This allows for Range Scans (e.g., WHERE age BETWEEN 20 AND 30) by finding the first value and simply walking across the neighbors.\n3. The Memory Level: The 8KB “Page” Database performance is dictated by how data is stored in memory. Databases move data in chunks called Pages.\nStandard Size: Usually 8 KB or 16 KB (to match the Operating System’s block size). The Fan-out Math: * If an Index Entry (Value + Pointer) is 10 bytes: One 8 KB Page can hold $\\approx 800$ entries. Level 1 (Root): 1 Page (800 ranges) Level 2 (Internal): 800 Pages ($800 \\times 800 = 640,000$ ranges) Level 3 (Leaf): 640,000 Pages ($\\approx 512,000,000$ pointers) Result: The database can find 1 specific row out of 500 million by reading only 3 pages (24 KB of data).\n4. Numeric vs. String Indexing Can you index strings (VARCHAR)? Yes. The B-Tree treats them lexicographically (dictionary order).\nFeature Numeric (INT) String (VARCHAR) Size Small (4-8 bytes) Large (can be 100s of bytes) Density High (More entries per page) Low (Fewer entries per page) Speed Faster (Shallow tree) Slower (Taller tree) Wildcards N/A Works for LIKE 'abc%', Fails for LIKE '%abc' 5. Maintenance: The Cost of Speed Indexes make SELECT fast, but they make INSERT/UPDATE slower. When you add a row, the database must:\nWrite the data to the table. Update the B-Tree. If a Page is full, perform a Page Split (creating a new page and re-balancing the tree), which is a heavy I/O operation. Summary Table: Index Types Type Logic Use Case Clustered Index The leaf node is the actual data row. Primary Keys. Non-Clustered The leaf node is a pointer to the data. Secondary lookups (Email, Name). 6. The “Handshake”: Why OS and Database Page Sizes Differ When you run getconf PAGESIZE on Ubuntu, you see 4096 (4 KB). Yet, your database often uses 8 KB or 16 KB. If the RAM can process data quickly, why is there this mismatch?\nThe Generalist (Ubuntu) vs. The Specialist (Database) Ubuntu (4 KB): An Operating System is a generalist. It manages everything from tiny config files to massive videos. If the OS used 16 KB pages, a 1 KB text file would still take up 16 KB of RAM—wasting 94% of that space. 4 KB is the “Goldilocks” size for general computing. Database (8 KB+): A database is a specialist. It knows its files are massive. By using a larger Logical Page, it increases Fan-out (the number of pointers per page). This keeps the B-Tree “short and fat” rather than “tall and skinny,” reducing the number of disk reads. How They Sync There is no “clash” because these sizes are multiples. When the Database asks for one 8 KB page, Ubuntu simply fetches two 4 KB hardware blocks.\nLayer Unit Size Role CPU Cache Cache Line 64 Bytes The ultra-fast “bite-sized” chunks the CPU actually chews on. Ubuntu (OS) Page 4 KB The standard unit for moving data from Disk to RAM. Database Page/Block 8 KB The logical unit for organizing the B-Tree index. 7. The Math of Pointer Density (6-byte vs. 8-byte) You might wonder: If a 64-bit system uses 8-byte addresses, why do databases try to use 6-byte pointers?\nIt comes down to Page Density. A smaller pointer allows more entries to fit into a single 8 KB page. Let’s look at the math for a table indexing a 4-byte Integer ID:\nScenario A: Standard 64-bit Pointer (8 bytes) Entry Size: 4B (ID) + 8B (Pointer) = 12 bytes Entries per Page: $8192 / 12 \\approx \\mathbf{682}$ Tree Capacity (3 Levels): $682^3 \\approx \\mathbf{317}$ Million rows Scenario B: Optimized Disk Pointer (6 bytes) Entry Size: 4B (ID) + 6B (Pointer) = 10 bytes Entries per Page: $8192 / 10 \\approx \\mathbf{819}$ Tree Capacity (3 Levels): $819^3 \\approx \\mathbf{550}$ Million rows The Deep Insight: By “shaving off” 2 bytes from the pointer, we increased the capacity of a 3-level tree by over 230 million rows without adding a single extra “jump” (Disk I/O). In the database world, smaller is faster.\n8. From Disk to RAM: The Buffer Pool The database doesn’t read your index byte-by-byte.\nOn Disk: The index is stored in 8 KB chunks. The Request: You search for ID 72. The Fetch: The DB finds the 8 KB page containing 72 and copies it exactly into a dedicated section of RAM called the Buffer Pool. The CPU Speed: Once that 8 KB page is in RAM, the CPU can scan those 819 entries in nanoseconds. 9. The Math of the 6-Byte Pointer: Why 256 Terabytes? You noticed a critical detail: $2^{48}$ is a massive number, but why does it equal 256 Terabytes and not Terabits?\nThe Calculation In computer architecture, addresses point to Bytes, not Bits.\n1 Byte = 8 Bits. 6 Bytes = 48 Bits. Total Addressable Units: $2^{48}$ bytes. Let’s break the math down: $$2^{10} = 1,024 \\text{ (1 Kilobyte)}$$ $$2^{20} = 1,048,576 \\text{ (1 Megabyte)}$$ $$2^{30} = 1,073,741,824 \\text{ (1 Gigabyte)}$$ $$2^{40} = 1,099,511,627,776 \\text{ (1 Terabyte)}$$\nSo, $2^{48}$ is actually $2^8 \\times 2^{40}$: $$256 \\times 1 \\text{ Terabyte} = \\mathbf{256 \\text{ Terabytes}}$$\nWhy Disk Pointers are 6 Bytes vs. RAM Pointers are 8 Bytes This is a classic “Software vs. Hardware” distinction.\nFeature RAM Pointer (Hardware) Disk Pointer (Database File) Size 8 Bytes (64-bit) 6 Bytes (48-bit) Reasoning Hardware Mandate: Your 64-bit CPU is “wired” to read 8-byte chunks. It is a physical requirement of the memory bus. Storage Optimization: Database engineers realized a single table rarely exceeds 256TB. Saving 2 bytes per pointer is a massive win. The “Translation” The CPU uses the address directly to talk to the RAM sticks. When the DB loads a page into RAM, it “pads” the 6-byte pointer with two extra zeros to make it 8 bytes so the CPU can read it. The Efficiency Gain By using 6 bytes on disk instead of 8, we aren’t just saving disk space; we are increasing Page Density. As we calculated earlier, this “shaving” of 2 bytes allows us to fit ~20% more entries into every 8 KB page.\nMore entries per page = A wider tree = Fewer disk seeks = Faster Queries.\n10. Summary: The Anatomy of a Search To wrap up the journey from the query to the hardware:\nThe Query: You ask for WHERE ID = 72. The Root/Internal Nodes: The DB navigates through 8 KB pages in RAM (or fetches them from disk). The Leaf Node: The DB finds the entry for 72. It reads the 6-byte disk pointer. The Padding: The DB software converts those 6 bytes into an 8-byte RAM address. The Fetch: The CPU uses that 8-byte address to grab the actual row data from the Buffer Pool or Disk. 11. The “Postman” Analogy: Why we address Bytes, not Bits One of the most common points of confusion in low-level systems is why a 48-bit pointer address equals 256 Terabytes and not Terabits. It all comes down to the Addressable Unit.\nThe Street vs. House Problem Imagine you are designing a postal system for a massive city:\nThe Bits (The Houses): There are billions of houses. If you give every single house a unique, 50-digit GPS coordinate, your “Address Book” (the Index) would eventually become larger than the city itself! The Byte (The Street): To be efficient, you group 8 houses together into one Street. Now, the postman only needs one address for the entire street. The Rule: In computer architecture, the smallest “Street” we address is 1 Byte (8 bits). Why not address every Bit? If we tried to give every single bit its own unique address:\nIndex Bloat: The index would take up 8x more space. Hardware Complexity: The CPU and RAM would have to be 8x more complex to manage those tiny, individual destinations. Instead, the CPU asks for the address of a Byte, pulls all 8 bits into its “hands” (the registers), changes the bit it needs, and puts the whole Byte back.\nThe Final Math Because every “Street” (Byte) has one unique pointer address:\nAddress size: 6 Bytes (48 bits). Number of “Streets” we can find: $2^{48}$ unique addresses. Total Capacity: Since each address holds 1 Byte, we can address $2^{48}$ Bytes. Conversion: $2^{48} \\text{ bytes} = \\mathbf{256 \\text{ Terabytes}}$. Key Takeaway: If a pointer points to 8 bits (1 Byte) as its smallest unit, it is called Byte-Addressable. This is the standard for almost all modern CPUs, RAM, and Databases.\n12. Summary Table: Bits, Bytes, and Pointers Unit What it is Can it be addressed? Bit A single 0 or 1 (A “House”) No. Too small; would make the index too large. Byte A group of 8 bits (A “Street”) Yes. This is the standard unit for all pointers. 6-Byte Pointer A 48-bit “Address” Yes. It can find $2^{48}$ different “Streets” (Bytes). 13. The Great Trade-off: 6-Byte vs. 8-Byte Pointers If your CPU and RAM already use 8-byte (64-bit) pointers, why does the database bother shrinking them to 6 bytes on the disk? Let’s look at the mathematical “gap” between these two choices.\nThe Astronomical Difference in Scale When we increase a pointer by just 2 bytes (16 bits), the capacity doesn’t just grow—it explodes.\nPointer Size Total Bits Math ($2^n$ Bytes) Max Addressable Capacity 6 Bytes 48 bits $2^{48}$ 256 Terabytes 8 Bytes 64 bits $2^{64}$ 16 Exabytes How big is 16 Exabytes? To put that in perspective:\n1 Petabyte = 1,024 Terabytes. 1 Exabyte = 1,024 Petabytes. 16 Exabytes is roughly 65,536 times larger than 256 Terabytes. An 8-byte pointer can address more data than almost all the world’s data centers combined today. It is effectively “infinite.”\nWhy Databases Choose the “Small” 6-Byte Pointer If 8 bytes is “future-proof” and “infinite,” why choose 6 bytes? It goes back to our 8 KB Page Density.\nLet’s assume we are indexing a standard 4-byte Integer ID:\nThe 8-byte Strategy (Standard):\nEntry = 4B (ID) + 8B (Pointer) = 12 bytes Page Capacity = ~682 entries The 6-byte Strategy (Optimized):\nEntry = 4B (ID) + 6B (Pointer) = 10 bytes Page Capacity = ~819 entries The Decision: Density Over Infinity Database engineers made a calculated bet:\nThe Bet: “Nobody is going to have a single table larger than 256 Terabytes anytime soon.” The Reward: By shaving off those 2 bytes, they fit 20% more entries into every single 8 KB page. Why does this matter? Fitting 20% more entries means the B-Tree is wider. A wider tree is a shorter tree. A shorter tree means the database needs fewer “jumps” to the disk to find your data. In the world of high-performance databases, 20% more density is worth more than 16 Exabytes of unused space.\n14. Comparison Summary Feature 6-Byte Disk Pointer 8-Byte RAM Pointer Capacity 256 TB (Practical) 16 EB (Infinite) Index Speed Faster (Higher page density) Slower (Lower page density) Disk Space Saved (2 bytes per row) Wasted (Empty padding) Where it lives On your Hard Drive / SSD Inside your CPU / RAM Conclusion: The database uses “compressed” 6-byte pointers on the disk to maximize speed, and only “inflates” them to 8-byte pointers when the data enters the CPU to satisfy the hardware’s 64-bit requirement.\n15. The “Zero-Padding” Trick: Why we don’t “Under-use” RAM If the hardware is built for 64-bit (8-byte) “gulping,” aren’t we wasting the CPU’s potential by only giving it 48 bits from the disk? This is where the distinction between Storage Efficiency and Execution Speed becomes vital.\nThe Shipping Container vs. The Workbench Think of your Disk as a shipping container and your RAM as a workbench:\nOn Disk (The Container): Space is expensive. If we store 64 bits but only use 48, we are shipping “empty air.” By packing only 48 bits (6 bytes), we fit 20% more pointers in the same 8 KB container. In RAM (The Workbench): Once the data is on the workbench, the CPU must use its 64-bit “tools” to work. How the CPU handles 48-bit Pointers When the database pulls a 6-byte pointer into RAM, it performs a Zero-Padding operation. It places your 48 bits into a 64-bit “register” (a tiny pocket inside the CPU) and fills the remaining 16 bits with zeros:\n[00000000 00000000] [48 bits of actual address]\nBecause a 64-bit CPU is designed to process 64 bits in a single clock cycle, it takes exactly the same amount of time to process this padded number as it would to process a full 64-bit number. We aren’t slowing down the CPU; we are just making the Disk work less.\n16. Visualizing the “Freed Up” Space Let’s visualize a row of pointers inside our 8 KB Page. By shrinking each “seat” from 8 bytes to 6 bytes, we allow the next pointer to start sooner.\nScenario A: 8-byte Pointers [Ptr 1: 8 bytes] [Ptr 2: 8 bytes] [Ptr 3: 8 bytes] Total used for 3 pointers: 24 bytes.\nScenario B: 6-byte Pointers [Ptr 1: 6 bytes] [Ptr 2: 6 bytes] [Ptr 3: 6 bytes] [Ptr 4: 6 bytes] Total used for 4 pointers: 24 bytes.\nThe “Free” Pointer: In the same 24 bytes of space, the 6-byte strategy fits one extra pointer. Scale this across an 8,192-byte page, and you gain roughly 137 extra entries per page.\n17. The Bottleneck Reality Why go through all this trouble to save 2 bytes? Because of the Latency Gap:\nReading from RAM: Takes ~100 nanoseconds. Reading from Disk (SSD): Takes ~100,000 nanoseconds. Reading from a disk is 1,000 times slower than reading from RAM. If saving 2 bytes per pointer allows the database to find your data in 3 disk reads instead of 4, you have saved 100,000 nanoseconds of time. In the world of database performance, we always trade CPU cycles to save Disk I/O.\nSummary Checklist for Database Indexing Logical Unit: Data is moved in 8 KB Pages. OS Unit: Ubuntu moves memory in 4 KB Pages. Pointer Size: 6 Bytes on disk (addresses up to 256 TB). Hardware Alignment: 8 Bytes in RAM (64-bit CPU standard). The Goal: Maximize Page Density to keep the B-Tree as short as possible. 18. The “Box in a Room” Analogy: Understanding Density To visualize how a database index scales, imagine a room that is exactly 8,192 square feet (our 8 KB Page). Your goal is to fit as many “Index Boxes” as possible into this room.\nEach box consists of two parts:\nThe Value: The data you are indexing (e.g., an ID or a Name). The Pointer: The 6-byte “address” telling you where the full row lives. Scenario A: The Lean Integer (4 Bytes) Box Width: 4B (Value) + 6B (Pointer) = 10 bytes. Room Capacity: $8192 / 10 = \\mathbf{819}$ boxes. The Result: High density. The database can find millions of rows in just 3 “jumps.” Scenario B: The Bulky UUID (16 Bytes) Many modern systems use UUIDs (Universally Unique Identifiers) because they are great for distributed systems. But they are “wide.”\nBox Width: 16B (Value) + 6B (Pointer) = 22 bytes. Room Capacity: $8192 / 22 \\approx \\mathbf{372}$ boxes. The Result: Your capacity has dropped by over 50%. 19. The “Multiplier Effect” of Fan-out Why does it matter if we have 819 boxes versus 372? It’s because of Fan-out. Every “box” in the Root node points to a whole new page.\nLook at how the total capacity of a 2-level tree changes based on box size:\nBox Size Pointers per Page Total Rows Found (2 Levels) 10 Bytes (Integer) 819 $819 \\times 819 = \\mathbf{670,761}$ 22 Bytes (UUID) 372 $372 \\times 372 = \\mathbf{138,384}$ The Deep Insight: By choosing a wider data type (like UUID or a long String), your index becomes less efficient. The tree grows taller, requiring more “jumps” to the disk.\nIn computer time:\n3 Jumps: Fast (likely fits in RAM). 5 Jumps: Slower (requires more trips to the physical SSD). 20. Conclusion: The Deep Planner’s Rules for Indexing After diving deep into the hardware, the OS, and the math, we can summarize the “laws” of database performance:\nThe 8 KB Page is Fixed: Ubuntu always moves 4 KB blocks, and the database always groups them into 8 KB logical units. We cannot change the “room” size, only how we pack it. Pointer Size is a Trade-off: We use 6-byte pointers instead of 8-byte pointers to lower the “denominator” and increase density. Data Width is King: Small data types (Integers) make for “fat, short” trees that are incredibly fast. Large data types (UUIDs, Strings) make for “skinny, tall” trees that are slower. Disk is the Bottleneck: Every design choice—from the 6-byte pointer to the 8 KB page—is made to avoid “Disk I/O.” Reading from an SSD is 1,000x slower than reading from RAM. Final Pro-Tip: When designing a database, always choose the smallest data type that safely fits your data. You aren’t just saving disk space; you are increasing the “Fan-out” of your index and making your entire application faster.\n21. The Chaos of the “Page Split” What happens when our 8 KB “room” is perfectly packed with 819 boxes, and we try to shove one more inside? The database cannot simply “push” the other boxes; that would be too slow. Instead, it performs a Page Split.\nHow a Page Split Works: Allocation: The DB creates a brand new, empty 8 KB page. The 50/50 Rule: It moves the bottom 50% of the entries from the full page into the new page. Insertion: It drops the new ID into the now-available space. The Link: It updates the “Parent” node to point to this new child page. The Performance Hit: While a SELECT only reads data, an INSERT that triggers a split must write two new pages to the disk and update the index hierarchy. This is why “heavy” indexing makes writes slower.\n22. Case Study: The UUID Performance Trap If you use Random UUIDs (v4) as primary keys in PostgreSQL, you are likely hitting a performance wall. Based on our “Deep Planning” math, here is why:\n1. The “Width” Problem A UUID is 16 bytes, whereas a standard Integer is 4 bytes.\nInteger Index: ~819 entries per page. UUID Index: ~372 entries per page. Result: Your index is 2x larger and the tree is taller, requiring more Disk I/O. 2. The “Locality” Problem (Fragmentation) Sequential IDs (1, 2, 3…): These always land at the “Right-Hand Edge” of the tree. The old pages stay perfectly packed and the DB only works on the last page. Random UUIDs (A, Z, B…): These land in the middle of random pages. This triggers constant Page Splits across the entire index, leaving your pages half-empty (fragmented). 3. The RAM Exhaustion Because random UUIDs can land anywhere, PostgreSQL must keep the entire index in RAM (the Buffer Pool) to stay fast. Once your UUID index grows larger than your available RAM, performance “falls off a cliff” as every single insert starts requiring a slow Disk Read.\n23. The Modern Solution: UUID v7 If you need the uniqueness of a UUID but the speed of an Integer, use UUID v7.\nThe Secret: The first 48 bits of a UUID v7 are a Timestamp. The Benefit: They are “Time-Ordered.” To the database, they behave like an Auto-Incrementing Integer, always landing at the end of the index and preventing chaotic Page Splits. Final Post Summary: The Deep Planner’s Checklist Feature The Goal The “Deep” Reason Page Size 8 KB Matches the OS (2x 4KB) while maximizing pointer density. Pointer Size 6 Bytes Large enough for 256TB, small enough to fit ~20% more data. Key Type Sequential Prevents Page Splits and keeps index pages “hot” in RAM. Data Width Small Maximizes Fan-out, keeping the search tree short and fast. 24. The Diagnosis: My PostgreSQL uses UUID v4 If you find that your primary keys are UUID v4, your database is currently playing a game of “Random Roulette” with your storage.\nThe Problem: Randomness vs. The 8 KB Page Every time you insert a new UUID v4, PostgreSQL picks a random page in your index.\nIf the page is full: It triggers a Page Split, moving 4 KB of data to make room for one 16-byte ID. If the page is in RAM: Great! If the page is on Disk: The database must “seek” a random location on your SSD, which is much slower than reading sequential data. 25. The Solution: Transitioning to UUID v7 You don’t need to rebuild your entire database to fix this. You can start “healing” the index today by switching new inserts to UUID v7.\nWhy UUID v7 Wins A UUID v7 looks exactly like a v4 (128 bits), but the first 48 bits are a Timestamp.\nTo the User: It looks like a random string. To the B-Tree: It behaves like a sequence. Because the timestamps always increase, new IDs always land on the “Right-Hand Edge” of the tree, filling up the 8 KB pages perfectly and ending the cycle of random Page Splits. Step-by-Step Implementation in PostgreSQL 1. Create the Generator Since native support for v7 is coming in PostgreSQL 18, we can use a PL/pgSQL function to generate them now:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 CREATE OR REPLACE FUNCTION uuid_generate_v7() RETURNS uuid AS $$ DECLARE unix_ts_ms bytea; uuid_bytes bytea; BEGIN -- 1. Get current timestamp in milliseconds (48 bits) unix_ts_ms := decode(lpad(to_hex(floor(extract(epoch from clock_timestamp()) * 1000)::bigint), 12, '0'), 'hex'); -- 2. Generate random bytes for the rest uuid_bytes := unix_ts_ms || gen_random_bytes(10); -- 3. Set version (7) and variant bits uuid_bytes := set_byte(uuid_bytes, 6, (get_byte(uuid_bytes, 6) \u0026 15) | 112); uuid_bytes := set_byte(uuid_bytes, 8, (get_byte(uuid_bytes, 8) \u0026 63) | 128); RETURN encode(uuid_bytes, 'hex')::uuid; END; $$ LANGUAGE plpgsql VOLATILE; The Final Result: A Balanced Ecosystem By understanding the interaction between the 48-bit pointer, the 8 KB Database Page, and the 4 KB OS block, we have moved from a fragmented, slow index to a high-density, sequential one.\nDensity: We fit the maximum number of entries per page. Locality: We keep related data physically close on the disk. Performance: We minimize Disk I/O, ensuring our 64-bit CPU spent more time processing and less time waiting for the \"slow\" storage. Final Note: If you want to \"clean up\" the mess left behind by old UUID v4s, run REINDEX TABLE your_table_name; during a maintenance window. This will repack all those 8 KB pages with maximum density. ## 27. Fixing the Ambiguous Join \u0026 Bloat Analysis When querying PostgreSQL system catalogs, columns like indexrelid appear in multiple tables. You must use Aliases (e.g., s. or i.) to tell Postgres exactly which table to look at.\nThe Corrected Bloat \u0026 Density Query Run this to see how your 8 KB pages are actually performing:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 SELECT s.schemaname, s.relname AS tablename, s.indexrelname, -- Estimated density: Ratio of used space vs the 8KB page limit round((c.reltuples * 12 / 8192.0), 2) AS density_score, pg_size_pretty(pg_relation_size(s.indexrelid)) AS index_size, pg_relation_size(s.indexrelid) / 8192 AS total_8kb_pages FROM pg_stat_user_indexes s JOIN pg_class c ON s.indexrelid = c.oid JOIN pg_index i ON s.indexrelid = i.indexrelid WHERE s.idx_scan \u003e 0; 28. The \"Heavy Data\" Reality: TSVectors I noticed you are building search_vector for your topic table using to_tsvector. This adds a new layer to our 8 KB Page math: The Box Size: Our UUID was 16 bytes. A tsvector of a description can be 500+ bytes. The Denominator: Instead of fitting 819 entries in an 8 KB page, a search index (GIN index) might only fit 10-15 entries per page. The Performance Impact: This is why Full-Text Search is \"heavy.\" Every search requires the CPU to decompress these large blocks and the Disk to fetch much larger pages. 29. Final Implementation Checklist (Postgres 17.7) Now that you have pgcrypto installed and the function tested, follow these steps to move your agent, user, and topic tables to the new standard: Step,Action,SQL Command 1,Apply Default,ALTER TABLE agent ALTER COLUMN id SET DEFAULT generate_uuid_v7(); 2,Apply Default,ALTER TABLE topic ALTER COLUMN id SET DEFAULT generate_uuid_v7(); 3,Repack Pages,REINDEX TABLE agent; 4,Verify,Run the Density Query again to see the score move closer to 0.9+. ## 30. The \"Smoking Gun\": Analyzing the 1.08% Density The result you provided from `pgstatindex` (`avg_leaf_density: 1.08`) is the ultimate proof of the **UUID v4** problem. ### The Math of the 1.08% * **Page Size:** 8,192 bytes (8 KB). * **Used Space:** $8192 \\times 0.0108 = \\mathbf{88.47 \\text{ bytes}}$. * **Wasted Space:** **8,103 bytes**. Because your UUIDs are random, PostgreSQL had to allocate a full **8 KB page** (the \"warehouse\") but has only parked about 88 bytes of data (roughly 5-6 UUID rows) inside it. Because the next UUID will be random, it might not even land in this page, forcing the DB to open yet *another* mostly-empty 8 KB page. --- ## 31. Correcting the Correlation Query You attempted to check the **Correlation** (how closely the physical order of data on the disk matches the index order). This is a vital \"Deep Planner\" metric. Your query failed because `public.organisation` is a string value, and the `tablename` column in `pg_stats` does not include the schema prefix. ### The Corrected SQL: ```sql SELECT tablename, attname AS column_name, correlation FROM pg_stats WHERE tablename = 'organisation' AND schemaname = 'public'; Gemini said Here is the breakdown of your Organisation table statistics and the corrected query to view them, formatted for your technical records. Markdown ## 30. The \"Smoking Gun\": Analyzing the 1.08% Density The result you provided from `pgstatindex` (`avg_leaf_density: 1.08`) is the ultimate proof of the **UUID v4** problem. ### The Math of the 1.08% * **Page Size:** 8,192 bytes (8 KB). * **Used Space:** $8192 \\times 0.0108 = \\mathbf{88.47 \\text{ bytes}}$. * **Wasted Space:** **8,103 bytes**. Because your UUIDs are random, PostgreSQL had to allocate a full **8 KB page** (the \"warehouse\") but has only parked about 88 bytes of data (roughly 5-6 UUID rows) inside it. Because the next UUID will be random, it might not even land in this page, forcing the DB to open yet *another* mostly-empty 8 KB page. --- ## 31. Correcting the Correlation Query You attempted to check the **Correlation** (how closely the physical order of data on the disk matches the index order). This is a vital \"Deep Planner\" metric. Your query failed because `public.organisation` is a string value, and the `tablename` column in `pg_stats` does not include the schema prefix. ### The Corrected SQL: ```sql SELECT tablename, attname AS column_name, correlation FROM pg_stats WHERE tablename = 'organisation' AND schemaname = 'public'; How to interpret the \"Correlation\" result: Near 1.0: Perfectly ordered (Sequential). This is what you have in your topic table (Integers). Near 0.0: Totally random (Chaos). This is what happens with UUID v4. Near -1.0: Perfectly ordered, but in reverse. 32. Final Comparison: Topic vs. Organisation Feature\ttopic table\torganisation table ID Type\tInteger (Serial)\tUUID v4 (Random) 8 KB Strategy\tSequential: Fills pages 1 to 100 perfectly.\tRandom: Scatters data, leaving pages 99% empty. Density Score\t9.62% (Low only because it's new)\t1.08% (Dangerously low) Action Taken\tNone needed.\tSwitched to UUID v7. The \"Deep Planner\" Result By switching the organisation table to generate_uuid_v7(), you are ensuring that as your company grows, the correlation score will move toward 1.0 and the density_score will move toward 90%+. You have successfully optimized the \"DNA\" of your primary storage. ## 33. Understanding the \"High Bloat\" Alarm When you run a bloat query on a small or brand-new database, you will often see **\"HIGH BLOAT\"** warnings across every table. While the term sounds scary, for your current setup, it is a mathematical illusion. ### The \"Empty Parking Garage\" Effect Look at your `index_size` column. Most of your indexes are exactly **16 KB**. * **Page 1 (8 KB):** The Metapage (stores index version and internal rules). * **Page 2 (8 KB):** The Leaf Page (where your actual IDs live). Because you only have a few rows of data, you are only using a few bytes of that second 8 KB page. * **Calculation:** If you have 5 rows (approx. 100 bytes) in an 8,192-byte page, your density is **1.2%**. * **Result:** The query flags this as \"High Bloat\" because the \"room\" is 99% empty. --- ## 34. Current Index Health Report | Table Name | Index Name | Size | Density | Status | Deep Planner Verdict | | :--- | :--- | :--- | :--- | :--- | :--- | | **organisation** | `PK_c725...` | 16 KB | ~1.08% | HIGH BLOAT | **Healthy.** Just needs more rows to fill the page. | | **topic** | `topic_id_seq` | 16 KB | ~9.62% | HIGH BLOAT | **Healthy.** Since it's an Integer, it will fill up perfectly. | | **agent** | `PK_...` | 16 KB | Low | HIGH BLOAT | **Action Needed:** Apply UUID v7 default. | ### When does \"High Bloat\" actually become a problem? Bloat only matters when your index size is **Large (MBs or GBs)**. * **Small Index (16 KB):** A density of 1% is fine. It just means the table is new. * **Large Index (500 MB):** A density of 1% means you are wasting 495 MB of RAM on \"empty air.\" This is when you must run `REINDEX`. --- ## 35. The \"Search Vector\" Performance Check I noticed your `topic` table is also 16 KB. Even after your `UPDATE` to the `search_vector`, the table hasn't grown. This is good! It means: 1. Your `search_vector` data is relatively small. 2. PostgreSQL's **Auto-Vacuum** hasn't needed to create massive new pages yet. ### Final Verification Query To see how the `search_vector` specifically is affecting your **Table Density** (not just the index), run this: ```sql SELECT relname AS table_name, pg_size_pretty(pg_total_relation_size(relid)) AS total_size, pg_size_pretty(pg_table_size(relid)) AS data_size, pg_size_pretty(pg_indexes_size(relid)) AS index_size FROM pg_stat_user_tables WHERE relname = 'topic'; Gemini said Here is the breakdown of your Index Bloat report, formatted for your technical records. Markdown ## 33. Understanding the \"High Bloat\" Alarm When you run a bloat query on a small or brand-new database, you will often see **\"HIGH BLOAT\"** warnings across every table. While the term sounds scary, for your current setup, it is a mathematical illusion. ### The \"Empty Parking Garage\" Effect Look at your `index_size` column. Most of your indexes are exactly **16 KB**. * **Page 1 (8 KB):** The Metapage (stores index version and internal rules). * **Page 2 (8 KB):** The Leaf Page (where your actual IDs live). Because you only have a few rows of data, you are only using a few bytes of that second 8 KB page. * **Calculation:** If you have 5 rows (approx. 100 bytes) in an 8,192-byte page, your density is **1.2%**. * **Result:** The query flags this as \"High Bloat\" because the \"room\" is 99% empty. --- ## 34. Current Index Health Report | Table Name | Index Name | Size | Density | Status | Deep Planner Verdict | | :--- | :--- | :--- | :--- | :--- | :--- | | **organisation** | `PK_c725...` | 16 KB | ~1.08% | HIGH BLOAT | **Healthy.** Just needs more rows to fill the page. | | **topic** | `topic_id_seq` | 16 KB | ~9.62% | HIGH BLOAT | **Healthy.** Since it's an Integer, it will fill up perfectly. | | **agent** | `PK_...` | 16 KB | Low | HIGH BLOAT | **Action Needed:** Apply UUID v7 default. | ### When does \"High Bloat\" actually become a problem? Bloat only matters when your index size is **Large (MBs or GBs)**. * **Small Index (16 KB):** A density of 1% is fine. It just means the table is new. * **Large Index (500 MB):** A density of 1% means you are wasting 495 MB of RAM on \"empty air.\" This is when you must run `REINDEX`. --- ## 35. The \"Search Vector\" Performance Check I noticed your `topic` table is also 16 KB. Even after your `UPDATE` to the `search_vector`, the table hasn't grown. This is good! It means: 1. Your `search_vector` data is relatively small. 2. PostgreSQL's **Auto-Vacuum** hasn't needed to create massive new pages yet. ### Final Verification Query To see how the `search_vector` specifically is affecting your **Table Density** (not just the index), run this: ```sql SELECT relname AS table_name, pg_size_pretty(pg_total_relation_size(relid)) AS total_size, pg_size_pretty(pg_table_size(relid)) AS data_size, pg_size_pretty(pg_indexes_size(relid)) AS index_size FROM pg_stat_user_tables WHERE relname = 'topic'; Summary of your \"Deep Plan\" Progress You have successfully: Diagnosed the UUID v4 fragmentation. Implemented the UUID v7 generator for time-sorted IDs. Clustered your organisation table to reclaim empty space. Audited your index health to establish a performance baseline. --- **Your database is now \"tuned\" for growth.** Since we have secured the IDs and the B-Tree density, would you like to explore **GIN Indexes** (specifically for your `search_vector`) to see how they differ from standard B-Trees? ",
  "wordCount" : "5923",
  "inLanguage": "en",
  "datePublished": "2026-02-25T00:00:00Z",
  "dateModified": "2026-02-25T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Rajesh Subramanian"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/drafts/postgres-internals-and-visuals/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Beyond the Bytes",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Beyond the Bytes (Alt + H)">Beyond the Bytes</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/journey" title="My Journey">
                    <span>My Journey</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Articles">
                    <span>Articles</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Deep Dive: How Database Indexing Works (The B-Tree)
    </h1>
    <div class="post-meta"><span title='2026-02-25 00:00:00 +0000 UTC'>February 25, 2026</span>&nbsp;·&nbsp;<span>28 min</span>&nbsp;·&nbsp;<span>5923 words</span>&nbsp;·&nbsp;<span>Rajesh Subramanian</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#the-fundamental-problem-the-full-table-scan" aria-label="The Fundamental Problem: The Full Table Scan">The Fundamental Problem: The Full Table Scan</a></li>
                <li>
                    <a href="#1-what-is-an-index" aria-label="1. What is an Index?">1. What is an Index?</a><ul>
                        
                <li>
                    <a href="#the-pointer-concept" aria-label="The &ldquo;Pointer&rdquo; Concept">The &ldquo;Pointer&rdquo; Concept</a></li></ul>
                </li>
                <li>
                    <a href="#2-the-anatomy-of-a-b-tree" aria-label="2. The Anatomy of a B-Tree">2. The Anatomy of a B-Tree</a></li>
                <li>
                    <a href="#3-the-memory-level-the-8kb-page" aria-label="3. The Memory Level: The 8KB &ldquo;Page&rdquo;">3. The Memory Level: The 8KB &ldquo;Page&rdquo;</a></li>
                <li>
                    <a href="#4-numeric-vs-string-indexing" aria-label="4. Numeric vs. String Indexing">4. Numeric vs. String Indexing</a></li>
                <li>
                    <a href="#5-maintenance-the-cost-of-speed" aria-label="5. Maintenance: The Cost of Speed">5. Maintenance: The Cost of Speed</a><ul>
                        
                <li>
                    <a href="#summary-table-index-types" aria-label="Summary Table: Index Types">Summary Table: Index Types</a></li></ul>
                </li>
                <li>
                    <a href="#6-the-handshake-why-os-and-database-page-sizes-differ" aria-label="6. The &ldquo;Handshake&rdquo;: Why OS and Database Page Sizes Differ">6. The &ldquo;Handshake&rdquo;: Why OS and Database Page Sizes Differ</a><ul>
                        
                <li>
                    <a href="#the-generalist-ubuntu-vs-the-specialist-database" aria-label="The Generalist (Ubuntu) vs. The Specialist (Database)">The Generalist (Ubuntu) vs. The Specialist (Database)</a></li>
                <li>
                    <a href="#how-they-sync" aria-label="How They Sync">How They Sync</a></li></ul>
                </li>
                <li>
                    <a href="#7-the-math-of-pointer-density-6-byte-vs-8-byte" aria-label="7. The Math of Pointer Density (6-byte vs. 8-byte)">7. The Math of Pointer Density (6-byte vs. 8-byte)</a><ul>
                        <ul>
                        
                <li>
                    <a href="#scenario-a-standard-64-bit-pointer-8-bytes" aria-label="Scenario A: Standard 64-bit Pointer (8 bytes)">Scenario A: Standard 64-bit Pointer (8 bytes)</a></li>
                <li>
                    <a href="#scenario-b-optimized-disk-pointer-6-bytes" aria-label="Scenario B: Optimized Disk Pointer (6 bytes)">Scenario B: Optimized Disk Pointer (6 bytes)</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#8-from-disk-to-ram-the-buffer-pool" aria-label="8. From Disk to RAM: The Buffer Pool">8. From Disk to RAM: The Buffer Pool</a></li>
                <li>
                    <a href="#9-the-math-of-the-6-byte-pointer-why-256-terabytes" aria-label="9. The Math of the 6-Byte Pointer: Why 256 Terabytes?">9. The Math of the 6-Byte Pointer: Why 256 Terabytes?</a><ul>
                        
                <li>
                    <a href="#the-calculation" aria-label="The Calculation">The Calculation</a></li>
                <li>
                    <a href="#why-disk-pointers-are-6-bytes-vs-ram-pointers-are-8-bytes" aria-label="Why Disk Pointers are 6 Bytes vs. RAM Pointers are 8 Bytes">Why Disk Pointers are 6 Bytes vs. RAM Pointers are 8 Bytes</a></li>
                <li>
                    <a href="#the-efficiency-gain" aria-label="The Efficiency Gain">The Efficiency Gain</a></li></ul>
                </li>
                <li>
                    <a href="#10-summary-the-anatomy-of-a-search" aria-label="10. Summary: The Anatomy of a Search">10. Summary: The Anatomy of a Search</a></li>
                <li>
                    <a href="#11-the-postman-analogy-why-we-address-bytes-not-bits" aria-label="11. The &ldquo;Postman&rdquo; Analogy: Why we address Bytes, not Bits">11. The &ldquo;Postman&rdquo; Analogy: Why we address Bytes, not Bits</a><ul>
                        
                <li>
                    <a href="#the-street-vs-house-problem" aria-label="The Street vs. House Problem">The Street vs. House Problem</a></li>
                <li>
                    <a href="#why-not-address-every-bit" aria-label="Why not address every Bit?">Why not address every Bit?</a></li>
                <li>
                    <a href="#the-final-math" aria-label="The Final Math">The Final Math</a></li></ul>
                </li>
                <li>
                    <a href="#12-summary-table-bits-bytes-and-pointers" aria-label="12. Summary Table: Bits, Bytes, and Pointers">12. Summary Table: Bits, Bytes, and Pointers</a></li>
                <li>
                    <a href="#13-the-great-trade-off-6-byte-vs-8-byte-pointers" aria-label="13. The Great Trade-off: 6-Byte vs. 8-Byte Pointers">13. The Great Trade-off: 6-Byte vs. 8-Byte Pointers</a><ul>
                        
                <li>
                    <a href="#the-astronomical-difference-in-scale" aria-label="The Astronomical Difference in Scale">The Astronomical Difference in Scale</a></li>
                <li>
                    <a href="#why-databases-choose-the-small-6-byte-pointer" aria-label="Why Databases Choose the &ldquo;Small&rdquo; 6-Byte Pointer">Why Databases Choose the &ldquo;Small&rdquo; 6-Byte Pointer</a></li>
                <li>
                    <a href="#the-decision-density-over-infinity" aria-label="The Decision: Density Over Infinity">The Decision: Density Over Infinity</a></li></ul>
                </li>
                <li>
                    <a href="#14-comparison-summary" aria-label="14. Comparison Summary">14. Comparison Summary</a></li>
                <li>
                    <a href="#15-the-zero-padding-trick-why-we-dont-under-use-ram" aria-label="15. The &ldquo;Zero-Padding&rdquo; Trick: Why we don&rsquo;t &ldquo;Under-use&rdquo; RAM">15. The &ldquo;Zero-Padding&rdquo; Trick: Why we don&rsquo;t &ldquo;Under-use&rdquo; RAM</a><ul>
                        
                <li>
                    <a href="#the-shipping-container-vs-the-workbench" aria-label="The Shipping Container vs. The Workbench">The Shipping Container vs. The Workbench</a></li>
                <li>
                    <a href="#how-the-cpu-handles-48-bit-pointers" aria-label="How the CPU handles 48-bit Pointers">How the CPU handles 48-bit Pointers</a></li></ul>
                </li>
                <li>
                    <a href="#16-visualizing-the-freed-up-space" aria-label="16. Visualizing the &ldquo;Freed Up&rdquo; Space">16. Visualizing the &ldquo;Freed Up&rdquo; Space</a></li>
                <li>
                    <a href="#17-the-bottleneck-reality" aria-label="17. The Bottleneck Reality">17. The Bottleneck Reality</a><ul>
                        
                <li>
                    <a href="#summary-checklist-for-database-indexing" aria-label="Summary Checklist for Database Indexing">Summary Checklist for Database Indexing</a></li></ul>
                </li>
                <li>
                    <a href="#18-the-box-in-a-room-analogy-understanding-density" aria-label="18. The &ldquo;Box in a Room&rdquo; Analogy: Understanding Density">18. The &ldquo;Box in a Room&rdquo; Analogy: Understanding Density</a><ul>
                        
                <li>
                    <a href="#scenario-a-the-lean-integer-4-bytes" aria-label="Scenario A: The Lean Integer (4 Bytes)">Scenario A: The Lean Integer (4 Bytes)</a></li>
                <li>
                    <a href="#scenario-b-the-bulky-uuid-16-bytes" aria-label="Scenario B: The Bulky UUID (16 Bytes)">Scenario B: The Bulky UUID (16 Bytes)</a></li></ul>
                </li>
                <li>
                    <a href="#19-the-multiplier-effect-of-fan-out" aria-label="19. The &ldquo;Multiplier Effect&rdquo; of Fan-out">19. The &ldquo;Multiplier Effect&rdquo; of Fan-out</a></li>
                <li>
                    <a href="#20-conclusion-the-deep-planners-rules-for-indexing" aria-label="20. Conclusion: The Deep Planner&rsquo;s Rules for Indexing">20. Conclusion: The Deep Planner&rsquo;s Rules for Indexing</a></li>
                <li>
                    <a href="#21-the-chaos-of-the-page-split" aria-label="21. The Chaos of the &ldquo;Page Split&rdquo;">21. The Chaos of the &ldquo;Page Split&rdquo;</a><ul>
                        
                <li>
                    <a href="#how-a-page-split-works" aria-label="How a Page Split Works:">How a Page Split Works:</a></li></ul>
                </li>
                <li>
                    <a href="#22-case-study-the-uuid-performance-trap" aria-label="22. Case Study: The UUID Performance Trap">22. Case Study: The UUID Performance Trap</a><ul>
                        
                <li>
                    <a href="#1-the-width-problem" aria-label="1. The &ldquo;Width&rdquo; Problem">1. The &ldquo;Width&rdquo; Problem</a></li>
                <li>
                    <a href="#2-the-locality-problem-fragmentation" aria-label="2. The &ldquo;Locality&rdquo; Problem (Fragmentation)">2. The &ldquo;Locality&rdquo; Problem (Fragmentation)</a></li>
                <li>
                    <a href="#3-the-ram-exhaustion" aria-label="3. The RAM Exhaustion">3. The RAM Exhaustion</a></li></ul>
                </li>
                <li>
                    <a href="#23-the-modern-solution-uuid-v7" aria-label="23. The Modern Solution: UUID v7">23. The Modern Solution: UUID v7</a></li>
                <li>
                    <a href="#final-post-summary-the-deep-planners-checklist" aria-label="Final Post Summary: The Deep Planner&rsquo;s Checklist">Final Post Summary: The Deep Planner&rsquo;s Checklist</a></li>
                <li>
                    <a href="#24-the-diagnosis-my-postgresql-uses-uuid-v4" aria-label="24. The Diagnosis: My PostgreSQL uses UUID v4">24. The Diagnosis: My PostgreSQL uses UUID v4</a><ul>
                        
                <li>
                    <a href="#the-problem-randomness-vs-the-8-kb-page" aria-label="The Problem: Randomness vs. The 8 KB Page">The Problem: Randomness vs. The 8 KB Page</a></li></ul>
                </li>
                <li>
                    <a href="#25-the-solution-transitioning-to-uuid-v7" aria-label="25. The Solution: Transitioning to UUID v7">25. The Solution: Transitioning to UUID v7</a><ul>
                        
                <li>
                    <a href="#why-uuid-v7-wins" aria-label="Why UUID v7 Wins">Why UUID v7 Wins</a></li>
                <li>
                    <a href="#step-by-step-implementation-in-postgresql" aria-label="Step-by-Step Implementation in PostgreSQL">Step-by-Step Implementation in PostgreSQL</a><ul>
                        
                <li>
                    <a href="#1-create-the-generator" aria-label="1. Create the Generator">1. Create the Generator</a></li></ul>
                </li>
                <li>
                    <a href="#the-corrected-bloat--density-query" aria-label="The Corrected Bloat &amp; Density Query">The Corrected Bloat &amp; Density Query</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="the-fundamental-problem-the-full-table-scan">The Fundamental Problem: The Full Table Scan<a hidden class="anchor" aria-hidden="true" href="#the-fundamental-problem-the-full-table-scan">#</a></h2>
<p>Imagine a table with 10 million rows. To find a specific ID without an index, the database must perform a <strong>Full Table Scan</strong>—checking every single row from 1 to 10,000,000. This is $O(n)$ complexity.</p>
<p>Indexing transforms this into a &ldquo;search in a book&rdquo; experience using a data structure called a <strong>B-Tree</strong>.</p>
<hr>
<h2 id="1-what-is-an-index">1. What is an Index?<a hidden class="anchor" aria-hidden="true" href="#1-what-is-an-index">#</a></h2>
<p>At its core, an index is a separate, sorted data structure that maps a specific value (like an ID or Name) to a <strong>Pointer</strong> (the physical address of the row on disk).</p>
<h3 id="the-pointer-concept">The &ldquo;Pointer&rdquo; Concept<a hidden class="anchor" aria-hidden="true" href="#the-pointer-concept">#</a></h3>
<ul>
<li><strong>The Index Record:</strong> Lives in the index tree. It says: &ldquo;Value 72 is at GPS Coordinate X.&rdquo;</li>
<li><strong>The Pointer:</strong> A physical address (File ID, Page ID, Slot No.) that tells the database exactly where to go on the hard drive to grab the full row.</li>
</ul>
<hr>
<h2 id="2-the-anatomy-of-a-b-tree">2. The Anatomy of a B-Tree<a hidden class="anchor" aria-hidden="true" href="#2-the-anatomy-of-a-b-tree">#</a></h2>
<p>A B-Tree (Balanced Tree) is a hierarchy of <strong>Pages</strong>. Instead of searching row-by-row, the database &ldquo;jumps&rdquo; through levels:</p>
<ol>
<li><strong>Root Node (The Starting Point):</strong> Contains broad ranges (e.g., &ldquo;Values 1-100 go to Page A, 101-200 go to Page B&rdquo;).</li>
<li><strong>Internal Nodes (The Navigators):</strong> Narrow the search further (e.g., &ldquo;Values 51-75 go to Page C&rdquo;).</li>
<li><strong>Leaf Nodes (The Destination):</strong> These contain the actual sorted values and their corresponding Pointers to the disk.</li>
</ol>
<blockquote>
<p><strong>Note:</strong> Leaf nodes are linked horizontally. This allows for <strong>Range Scans</strong> (e.g., <code>WHERE age BETWEEN 20 AND 30</code>) by finding the first value and simply walking across the neighbors.</p>
</blockquote>
<hr>
<h2 id="3-the-memory-level-the-8kb-page">3. The Memory Level: The 8KB &ldquo;Page&rdquo;<a hidden class="anchor" aria-hidden="true" href="#3-the-memory-level-the-8kb-page">#</a></h2>
<p>Database performance is dictated by how data is stored in memory. Databases move data in chunks called <strong>Pages</strong>.</p>
<ul>
<li><strong>Standard Size:</strong> Usually <strong>8 KB</strong> or <strong>16 KB</strong> (to match the Operating System&rsquo;s block size).</li>
<li><strong>The Fan-out Math:</strong> * If an Index Entry (Value + Pointer) is <strong>10 bytes</strong>:
<ul>
<li>One 8 KB Page can hold $\approx 800$ entries.</li>
<li><strong>Level 1 (Root):</strong> 1 Page (800 ranges)</li>
<li><strong>Level 2 (Internal):</strong> 800 Pages ($800 \times 800 = 640,000$ ranges)</li>
<li><strong>Level 3 (Leaf):</strong> 640,000 Pages ($\approx 512,000,000$ pointers)</li>
</ul>
</li>
</ul>
<p><strong>Result:</strong> The database can find 1 specific row out of 500 million by reading only <strong>3 pages</strong> (24 KB of data).</p>
<hr>
<h2 id="4-numeric-vs-string-indexing">4. Numeric vs. String Indexing<a hidden class="anchor" aria-hidden="true" href="#4-numeric-vs-string-indexing">#</a></h2>
<p>Can you index strings (<code>VARCHAR</code>)? <strong>Yes.</strong> The B-Tree treats them lexicographically (dictionary order).</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Feature</th>
          <th style="text-align: left">Numeric (INT)</th>
          <th style="text-align: left">String (VARCHAR)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Size</strong></td>
          <td style="text-align: left">Small (4-8 bytes)</td>
          <td style="text-align: left">Large (can be 100s of bytes)</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Density</strong></td>
          <td style="text-align: left">High (More entries per page)</td>
          <td style="text-align: left">Low (Fewer entries per page)</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Speed</strong></td>
          <td style="text-align: left">Faster (Shallow tree)</td>
          <td style="text-align: left">Slower (Taller tree)</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Wildcards</strong></td>
          <td style="text-align: left">N/A</td>
          <td style="text-align: left">Works for <code>LIKE 'abc%'</code>, Fails for <code>LIKE '%abc'</code></td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="5-maintenance-the-cost-of-speed">5. Maintenance: The Cost of Speed<a hidden class="anchor" aria-hidden="true" href="#5-maintenance-the-cost-of-speed">#</a></h2>
<p>Indexes make <strong>SELECT</strong> fast, but they make <strong>INSERT/UPDATE</strong> slower.
When you add a row, the database must:</p>
<ol>
<li>Write the data to the table.</li>
<li>Update the B-Tree.</li>
<li>If a Page is full, perform a <strong>Page Split</strong> (creating a new page and re-balancing the tree), which is a heavy I/O operation.</li>
</ol>
<hr>
<h3 id="summary-table-index-types">Summary Table: Index Types<a hidden class="anchor" aria-hidden="true" href="#summary-table-index-types">#</a></h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Type</th>
          <th style="text-align: left">Logic</th>
          <th style="text-align: left">Use Case</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Clustered Index</strong></td>
          <td style="text-align: left">The leaf node <em>is</em> the actual data row.</td>
          <td style="text-align: left">Primary Keys.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Non-Clustered</strong></td>
          <td style="text-align: left">The leaf node is a <em>pointer</em> to the data.</td>
          <td style="text-align: left">Secondary lookups (Email, Name).</td>
      </tr>
  </tbody>
</table>
<h2 id="6-the-handshake-why-os-and-database-page-sizes-differ">6. The &ldquo;Handshake&rdquo;: Why OS and Database Page Sizes Differ<a hidden class="anchor" aria-hidden="true" href="#6-the-handshake-why-os-and-database-page-sizes-differ">#</a></h2>
<p>When you run <code>getconf PAGESIZE</code> on Ubuntu, you see <code>4096</code> (4 KB). Yet, your database often uses <strong>8 KB</strong> or <strong>16 KB</strong>. If the RAM can process data quickly, why is there this mismatch?</p>
<h3 id="the-generalist-ubuntu-vs-the-specialist-database">The Generalist (Ubuntu) vs. The Specialist (Database)<a hidden class="anchor" aria-hidden="true" href="#the-generalist-ubuntu-vs-the-specialist-database">#</a></h3>
<ul>
<li><strong>Ubuntu (4 KB):</strong> An Operating System is a generalist. It manages everything from tiny config files to massive videos. If the OS used 16 KB pages, a 1 KB text file would still take up 16 KB of RAM—wasting 94% of that space. 4 KB is the &ldquo;Goldilocks&rdquo; size for general computing.</li>
<li><strong>Database (8 KB+):</strong> A database is a specialist. It knows its files are massive. By using a larger <strong>Logical Page</strong>, it increases <strong>Fan-out</strong> (the number of pointers per page). This keeps the B-Tree &ldquo;short and fat&rdquo; rather than &ldquo;tall and skinny,&rdquo; reducing the number of disk reads.</li>
</ul>
<h3 id="how-they-sync">How They Sync<a hidden class="anchor" aria-hidden="true" href="#how-they-sync">#</a></h3>
<p>There is no &ldquo;clash&rdquo; because these sizes are multiples. When the Database asks for one 8 KB page, Ubuntu simply fetches <strong>two</strong> 4 KB hardware blocks.</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Layer</th>
          <th style="text-align: left">Unit</th>
          <th style="text-align: left">Size</th>
          <th style="text-align: left">Role</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>CPU Cache</strong></td>
          <td style="text-align: left">Cache Line</td>
          <td style="text-align: left">64 Bytes</td>
          <td style="text-align: left">The ultra-fast &ldquo;bite-sized&rdquo; chunks the CPU actually chews on.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Ubuntu (OS)</strong></td>
          <td style="text-align: left">Page</td>
          <td style="text-align: left">4 KB</td>
          <td style="text-align: left">The standard unit for moving data from Disk to RAM.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Database</strong></td>
          <td style="text-align: left">Page/Block</td>
          <td style="text-align: left">8 KB</td>
          <td style="text-align: left">The logical unit for organizing the B-Tree index.</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="7-the-math-of-pointer-density-6-byte-vs-8-byte">7. The Math of Pointer Density (6-byte vs. 8-byte)<a hidden class="anchor" aria-hidden="true" href="#7-the-math-of-pointer-density-6-byte-vs-8-byte">#</a></h2>
<p>You might wonder: <em>If a 64-bit system uses 8-byte addresses, why do databases try to use 6-byte pointers?</em></p>
<p>It comes down to <strong>Page Density</strong>. A smaller pointer allows more entries to fit into a single 8 KB page. Let’s look at the math for a table indexing a 4-byte Integer ID:</p>
<h4 id="scenario-a-standard-64-bit-pointer-8-bytes">Scenario A: Standard 64-bit Pointer (8 bytes)<a hidden class="anchor" aria-hidden="true" href="#scenario-a-standard-64-bit-pointer-8-bytes">#</a></h4>
<ul>
<li><strong>Entry Size:</strong> 4B (ID) + 8B (Pointer) = <strong>12 bytes</strong></li>
<li><strong>Entries per Page:</strong> $8192 / 12 \approx \mathbf{682}$</li>
<li><strong>Tree Capacity (3 Levels):</strong> $682^3 \approx \mathbf{317}$ <strong>Million rows</strong></li>
</ul>
<h4 id="scenario-b-optimized-disk-pointer-6-bytes">Scenario B: Optimized Disk Pointer (6 bytes)<a hidden class="anchor" aria-hidden="true" href="#scenario-b-optimized-disk-pointer-6-bytes">#</a></h4>
<ul>
<li><strong>Entry Size:</strong> 4B (ID) + 6B (Pointer) = <strong>10 bytes</strong></li>
<li><strong>Entries per Page:</strong> $8192 / 10 \approx \mathbf{819}$</li>
<li><strong>Tree Capacity (3 Levels):</strong> $819^3 \approx \mathbf{550}$ <strong>Million rows</strong></li>
</ul>
<p><strong>The Deep Insight:</strong> By &ldquo;shaving off&rdquo; 2 bytes from the pointer, we increased the capacity of a 3-level tree by over <strong>230 million rows</strong> without adding a single extra &ldquo;jump&rdquo; (Disk I/O). In the database world, <strong>smaller is faster.</strong></p>
<hr>
<h2 id="8-from-disk-to-ram-the-buffer-pool">8. From Disk to RAM: The Buffer Pool<a hidden class="anchor" aria-hidden="true" href="#8-from-disk-to-ram-the-buffer-pool">#</a></h2>
<p>The database doesn&rsquo;t read your index byte-by-byte.</p>
<ol>
<li><strong>On Disk:</strong> The index is stored in 8 KB chunks.</li>
<li><strong>The Request:</strong> You search for <code>ID 72</code>.</li>
<li><strong>The Fetch:</strong> The DB finds the 8 KB page containing <code>72</code> and copies it <strong>exactly</strong> into a dedicated section of RAM called the <strong>Buffer Pool</strong>.</li>
<li><strong>The CPU Speed:</strong> Once that 8 KB page is in RAM, the CPU can scan those 819 entries in nanoseconds.</li>
</ol>
<hr>
<h2 id="9-the-math-of-the-6-byte-pointer-why-256-terabytes">9. The Math of the 6-Byte Pointer: Why 256 Terabytes?<a hidden class="anchor" aria-hidden="true" href="#9-the-math-of-the-6-byte-pointer-why-256-terabytes">#</a></h2>
<p>You noticed a critical detail: $2^{48}$ is a massive number, but why does it equal <strong>256 Terabytes</strong> and not Terabits?</p>
<h3 id="the-calculation">The Calculation<a hidden class="anchor" aria-hidden="true" href="#the-calculation">#</a></h3>
<p>In computer architecture, addresses point to <strong>Bytes</strong>, not Bits.</p>
<ul>
<li><strong>1 Byte</strong> = 8 Bits.</li>
<li><strong>6 Bytes</strong> = 48 Bits.</li>
<li><strong>Total Addressable Units:</strong> $2^{48}$ bytes.</li>
</ul>
<p>Let&rsquo;s break the math down:
$$2^{10} = 1,024 \text{ (1 Kilobyte)}$$
$$2^{20} = 1,048,576 \text{ (1 Megabyte)}$$
$$2^{30} = 1,073,741,824 \text{ (1 Gigabyte)}$$
$$2^{40} = 1,099,511,627,776 \text{ (1 Terabyte)}$$</p>
<p>So, $2^{48}$ is actually $2^8 \times 2^{40}$:
$$256 \times 1 \text{ Terabyte} = \mathbf{256 \text{ Terabytes}}$$</p>
<h3 id="why-disk-pointers-are-6-bytes-vs-ram-pointers-are-8-bytes">Why Disk Pointers are 6 Bytes vs. RAM Pointers are 8 Bytes<a hidden class="anchor" aria-hidden="true" href="#why-disk-pointers-are-6-bytes-vs-ram-pointers-are-8-bytes">#</a></h3>
<p>This is a classic &ldquo;Software vs. Hardware&rdquo; distinction.</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Feature</th>
          <th style="text-align: left">RAM Pointer (Hardware)</th>
          <th style="text-align: left">Disk Pointer (Database File)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Size</strong></td>
          <td style="text-align: left"><strong>8 Bytes</strong> (64-bit)</td>
          <td style="text-align: left"><strong>6 Bytes</strong> (48-bit)</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Reasoning</strong></td>
          <td style="text-align: left"><strong>Hardware Mandate:</strong> Your 64-bit CPU is &ldquo;wired&rdquo; to read 8-byte chunks. It is a physical requirement of the memory bus.</td>
          <td style="text-align: left"><strong>Storage Optimization:</strong> Database engineers realized a single table rarely exceeds 256TB. Saving 2 bytes per pointer is a massive win.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>The &ldquo;Translation&rdquo;</strong></td>
          <td style="text-align: left">The CPU uses the address directly to talk to the RAM sticks.</td>
          <td style="text-align: left">When the DB loads a page into RAM, it &ldquo;pads&rdquo; the 6-byte pointer with two extra zeros to make it 8 bytes so the CPU can read it.</td>
      </tr>
  </tbody>
</table>
<h3 id="the-efficiency-gain">The Efficiency Gain<a hidden class="anchor" aria-hidden="true" href="#the-efficiency-gain">#</a></h3>
<p>By using 6 bytes on disk instead of 8, we aren&rsquo;t just saving disk space; we are increasing <strong>Page Density</strong>. As we calculated earlier, this &ldquo;shaving&rdquo; of 2 bytes allows us to fit ~20% more entries into every 8 KB page.</p>
<p><strong>More entries per page = A wider tree = Fewer disk seeks = Faster Queries.</strong></p>
<hr>
<h2 id="10-summary-the-anatomy-of-a-search">10. Summary: The Anatomy of a Search<a hidden class="anchor" aria-hidden="true" href="#10-summary-the-anatomy-of-a-search">#</a></h2>
<p>To wrap up the journey from the query to the hardware:</p>
<ol>
<li><strong>The Query:</strong> You ask for <code>WHERE ID = 72</code>.</li>
<li><strong>The Root/Internal Nodes:</strong> The DB navigates through 8 KB pages in RAM (or fetches them from disk).</li>
<li><strong>The Leaf Node:</strong> The DB finds the entry for <code>72</code>. It reads the <strong>6-byte disk pointer</strong>.</li>
<li><strong>The Padding:</strong> The DB software converts those 6 bytes into an <strong>8-byte RAM address</strong>.</li>
<li><strong>The Fetch:</strong> The CPU uses that 8-byte address to grab the actual row data from the Buffer Pool or Disk.</li>
</ol>
<h2 id="11-the-postman-analogy-why-we-address-bytes-not-bits">11. The &ldquo;Postman&rdquo; Analogy: Why we address Bytes, not Bits<a hidden class="anchor" aria-hidden="true" href="#11-the-postman-analogy-why-we-address-bytes-not-bits">#</a></h2>
<p>One of the most common points of confusion in low-level systems is why a 48-bit pointer address equals <strong>256 Terabytes</strong> and not <strong>Terabits</strong>. It all comes down to the <strong>Addressable Unit</strong>.</p>
<h3 id="the-street-vs-house-problem">The Street vs. House Problem<a hidden class="anchor" aria-hidden="true" href="#the-street-vs-house-problem">#</a></h3>
<p>Imagine you are designing a postal system for a massive city:</p>
<ul>
<li><strong>The Bits (The Houses):</strong> There are billions of houses. If you give every single house a unique, 50-digit GPS coordinate, your &ldquo;Address Book&rdquo; (the Index) would eventually become larger than the city itself!</li>
<li><strong>The Byte (The Street):</strong> To be efficient, you group 8 houses together into one <strong>Street</strong>. Now, the postman only needs one address for the entire street.</li>
<li><strong>The Rule:</strong> In computer architecture, the smallest &ldquo;Street&rdquo; we address is <strong>1 Byte (8 bits)</strong>.</li>
</ul>
<h3 id="why-not-address-every-bit">Why not address every Bit?<a hidden class="anchor" aria-hidden="true" href="#why-not-address-every-bit">#</a></h3>
<p>If we tried to give every single bit its own unique address:</p>
<ol>
<li><strong>Index Bloat:</strong> The index would take up 8x more space.</li>
<li><strong>Hardware Complexity:</strong> The CPU and RAM would have to be 8x more complex to manage those tiny, individual destinations.</li>
</ol>
<p>Instead, the CPU asks for the address of a <strong>Byte</strong>, pulls all 8 bits into its &ldquo;hands&rdquo; (the registers), changes the bit it needs, and puts the whole Byte back.</p>
<h3 id="the-final-math">The Final Math<a hidden class="anchor" aria-hidden="true" href="#the-final-math">#</a></h3>
<p>Because every &ldquo;Street&rdquo; (Byte) has one unique pointer address:</p>
<ol>
<li><strong>Address size:</strong> 6 Bytes (48 bits).</li>
<li><strong>Number of &ldquo;Streets&rdquo; we can find:</strong> $2^{48}$ unique addresses.</li>
<li><strong>Total Capacity:</strong> Since each address holds 1 Byte, we can address $2^{48}$ <strong>Bytes</strong>.</li>
<li><strong>Conversion:</strong> $2^{48} \text{ bytes} = \mathbf{256 \text{ Terabytes}}$.</li>
</ol>
<blockquote>
<p><strong>Key Takeaway:</strong> If a pointer points to 8 bits (1 Byte) as its smallest unit, it is called <strong>Byte-Addressable</strong>. This is the standard for almost all modern CPUs, RAM, and Databases.</p>
</blockquote>
<hr>
<h2 id="12-summary-table-bits-bytes-and-pointers">12. Summary Table: Bits, Bytes, and Pointers<a hidden class="anchor" aria-hidden="true" href="#12-summary-table-bits-bytes-and-pointers">#</a></h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Unit</th>
          <th style="text-align: left">What it is</th>
          <th style="text-align: left">Can it be addressed?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Bit</strong></td>
          <td style="text-align: left">A single 0 or 1 (A &ldquo;House&rdquo;)</td>
          <td style="text-align: left"><strong>No.</strong> Too small; would make the index too large.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Byte</strong></td>
          <td style="text-align: left">A group of 8 bits (A &ldquo;Street&rdquo;)</td>
          <td style="text-align: left"><strong>Yes.</strong> This is the standard unit for all pointers.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>6-Byte Pointer</strong></td>
          <td style="text-align: left">A 48-bit &ldquo;Address&rdquo;</td>
          <td style="text-align: left"><strong>Yes.</strong> It can find $2^{48}$ different &ldquo;Streets&rdquo; (Bytes).</td>
      </tr>
  </tbody>
</table>
<h2 id="13-the-great-trade-off-6-byte-vs-8-byte-pointers">13. The Great Trade-off: 6-Byte vs. 8-Byte Pointers<a hidden class="anchor" aria-hidden="true" href="#13-the-great-trade-off-6-byte-vs-8-byte-pointers">#</a></h2>
<p>If your CPU and RAM already use 8-byte (64-bit) pointers, why does the database bother shrinking them to 6 bytes on the disk? Let&rsquo;s look at the mathematical &ldquo;gap&rdquo; between these two choices.</p>
<h3 id="the-astronomical-difference-in-scale">The Astronomical Difference in Scale<a hidden class="anchor" aria-hidden="true" href="#the-astronomical-difference-in-scale">#</a></h3>
<p>When we increase a pointer by just 2 bytes (16 bits), the capacity doesn&rsquo;t just grow—it explodes.</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Pointer Size</th>
          <th style="text-align: left">Total Bits</th>
          <th style="text-align: left">Math ($2^n$ Bytes)</th>
          <th style="text-align: left">Max Addressable Capacity</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>6 Bytes</strong></td>
          <td style="text-align: left">48 bits</td>
          <td style="text-align: left">$2^{48}$</td>
          <td style="text-align: left"><strong>256 Terabytes</strong></td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>8 Bytes</strong></td>
          <td style="text-align: left">64 bits</td>
          <td style="text-align: left">$2^{64}$</td>
          <td style="text-align: left"><strong>16 Exabytes</strong></td>
      </tr>
  </tbody>
</table>
<p><strong>How big is 16 Exabytes?</strong>
To put that in perspective:</p>
<ul>
<li>1 Petabyte = 1,024 Terabytes.</li>
<li>1 Exabyte = 1,024 Petabytes.</li>
<li><strong>16 Exabytes</strong> is roughly <strong>65,536 times larger</strong> than 256 Terabytes.</li>
</ul>
<p>An 8-byte pointer can address more data than almost all the world&rsquo;s data centers combined today. It is effectively &ldquo;infinite.&rdquo;</p>
<h3 id="why-databases-choose-the-small-6-byte-pointer">Why Databases Choose the &ldquo;Small&rdquo; 6-Byte Pointer<a hidden class="anchor" aria-hidden="true" href="#why-databases-choose-the-small-6-byte-pointer">#</a></h3>
<p>If 8 bytes is &ldquo;future-proof&rdquo; and &ldquo;infinite,&rdquo; why choose 6 bytes? It goes back to our <strong>8 KB Page Density</strong>.</p>
<p>Let&rsquo;s assume we are indexing a standard 4-byte Integer ID:</p>
<ol>
<li>
<p><strong>The 8-byte Strategy (Standard):</strong></p>
<ul>
<li>Entry = 4B (ID) + 8B (Pointer) = <strong>12 bytes</strong></li>
<li>Page Capacity = <strong>~682 entries</strong></li>
</ul>
</li>
<li>
<p><strong>The 6-byte Strategy (Optimized):</strong></p>
<ul>
<li>Entry = 4B (ID) + 6B (Pointer) = <strong>10 bytes</strong></li>
<li>Page Capacity = <strong>~819 entries</strong></li>
</ul>
</li>
</ol>
<h3 id="the-decision-density-over-infinity">The Decision: Density Over Infinity<a hidden class="anchor" aria-hidden="true" href="#the-decision-density-over-infinity">#</a></h3>
<p>Database engineers made a calculated bet:</p>
<ul>
<li><strong>The Bet:</strong> &ldquo;Nobody is going to have a single table larger than 256 Terabytes anytime soon.&rdquo;</li>
<li><strong>The Reward:</strong> By shaving off those 2 bytes, they fit <strong>20% more entries</strong> into every single 8 KB page.</li>
</ul>
<p><strong>Why does this matter?</strong> Fitting 20% more entries means the B-Tree is <strong>wider</strong>. A wider tree is a <strong>shorter tree</strong>. A shorter tree means the database needs fewer &ldquo;jumps&rdquo; to the disk to find your data. In the world of high-performance databases, <strong>20% more density is worth more than 16 Exabytes of unused space.</strong></p>
<hr>
<h2 id="14-comparison-summary">14. Comparison Summary<a hidden class="anchor" aria-hidden="true" href="#14-comparison-summary">#</a></h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Feature</th>
          <th style="text-align: left">6-Byte Disk Pointer</th>
          <th style="text-align: left">8-Byte RAM Pointer</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Capacity</strong></td>
          <td style="text-align: left">256 TB (Practical)</td>
          <td style="text-align: left">16 EB (Infinite)</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Index Speed</strong></td>
          <td style="text-align: left"><strong>Faster</strong> (Higher page density)</td>
          <td style="text-align: left"><strong>Slower</strong> (Lower page density)</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Disk Space</strong></td>
          <td style="text-align: left">Saved (2 bytes per row)</td>
          <td style="text-align: left">Wasted (Empty padding)</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Where it lives</strong></td>
          <td style="text-align: left">On your Hard Drive / SSD</td>
          <td style="text-align: left">Inside your CPU / RAM</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p><strong>Conclusion:</strong> The database uses &ldquo;compressed&rdquo; 6-byte pointers on the disk to maximize speed, and only &ldquo;inflates&rdquo; them to 8-byte pointers when the data enters the CPU to satisfy the hardware&rsquo;s 64-bit requirement.</p>
</blockquote>
<h2 id="15-the-zero-padding-trick-why-we-dont-under-use-ram">15. The &ldquo;Zero-Padding&rdquo; Trick: Why we don&rsquo;t &ldquo;Under-use&rdquo; RAM<a hidden class="anchor" aria-hidden="true" href="#15-the-zero-padding-trick-why-we-dont-under-use-ram">#</a></h2>
<p>If the hardware is built for 64-bit (8-byte) &ldquo;gulping,&rdquo; aren&rsquo;t we wasting the CPU&rsquo;s potential by only giving it 48 bits from the disk? This is where the distinction between <strong>Storage Efficiency</strong> and <strong>Execution Speed</strong> becomes vital.</p>
<h3 id="the-shipping-container-vs-the-workbench">The Shipping Container vs. The Workbench<a hidden class="anchor" aria-hidden="true" href="#the-shipping-container-vs-the-workbench">#</a></h3>
<p>Think of your <strong>Disk</strong> as a shipping container and your <strong>RAM</strong> as a workbench:</p>
<ul>
<li><strong>On Disk (The Container):</strong> Space is expensive. If we store 64 bits but only use 48, we are shipping &ldquo;empty air.&rdquo; By packing only 48 bits (6 bytes), we fit 20% more pointers in the same 8 KB container.</li>
<li><strong>In RAM (The Workbench):</strong> Once the data is on the workbench, the CPU must use its 64-bit &ldquo;tools&rdquo; to work.</li>
</ul>
<h3 id="how-the-cpu-handles-48-bit-pointers">How the CPU handles 48-bit Pointers<a hidden class="anchor" aria-hidden="true" href="#how-the-cpu-handles-48-bit-pointers">#</a></h3>
<p>When the database pulls a 6-byte pointer into RAM, it performs a <strong>Zero-Padding</strong> operation. It places your 48 bits into a 64-bit &ldquo;register&rdquo; (a tiny pocket inside the CPU) and fills the remaining 16 bits with zeros:</p>
<p><code>[00000000 00000000] [48 bits of actual address]</code></p>
<p>Because a 64-bit CPU is designed to process 64 bits in a single clock cycle, it takes <strong>exactly the same amount of time</strong> to process this padded number as it would to process a full 64-bit number. We aren&rsquo;t slowing down the CPU; we are just making the Disk work less.</p>
<hr>
<h2 id="16-visualizing-the-freed-up-space">16. Visualizing the &ldquo;Freed Up&rdquo; Space<a hidden class="anchor" aria-hidden="true" href="#16-visualizing-the-freed-up-space">#</a></h2>
<p>Let&rsquo;s visualize a row of pointers inside our 8 KB Page. By shrinking each &ldquo;seat&rdquo; from 8 bytes to 6 bytes, we allow the next pointer to start sooner.</p>
<p><strong>Scenario A: 8-byte Pointers</strong>
<code>[Ptr 1: 8 bytes] [Ptr 2: 8 bytes] [Ptr 3: 8 bytes]</code>
<em>Total used for 3 pointers: 24 bytes.</em></p>
<p><strong>Scenario B: 6-byte Pointers</strong>
<code>[Ptr 1: 6 bytes] [Ptr 2: 6 bytes] [Ptr 3: 6 bytes] [Ptr 4: 6 bytes]</code>
<em>Total used for 4 pointers: 24 bytes.</em></p>
<p><strong>The &ldquo;Free&rdquo; Pointer:</strong> In the same 24 bytes of space, the 6-byte strategy fits <strong>one extra pointer</strong>. Scale this across an 8,192-byte page, and you gain roughly <strong>137 extra entries</strong> per page.</p>
<hr>
<h2 id="17-the-bottleneck-reality">17. The Bottleneck Reality<a hidden class="anchor" aria-hidden="true" href="#17-the-bottleneck-reality">#</a></h2>
<p>Why go through all this trouble to save 2 bytes? Because of the <strong>Latency Gap</strong>:</p>
<ul>
<li><strong>Reading from RAM:</strong> Takes ~100 nanoseconds.</li>
<li><strong>Reading from Disk (SSD):</strong> Takes ~100,000 nanoseconds.</li>
</ul>
<p>Reading from a disk is <strong>1,000 times slower</strong> than reading from RAM. If saving 2 bytes per pointer allows the database to find your data in 3 disk reads instead of 4, you have saved 100,000 nanoseconds of time. In the world of database performance, <strong>we always trade CPU cycles to save Disk I/O.</strong></p>
<hr>
<h3 id="summary-checklist-for-database-indexing">Summary Checklist for Database Indexing<a hidden class="anchor" aria-hidden="true" href="#summary-checklist-for-database-indexing">#</a></h3>
<ol>
<li><strong>Logical Unit:</strong> Data is moved in <strong>8 KB Pages</strong>.</li>
<li><strong>OS Unit:</strong> Ubuntu moves memory in <strong>4 KB Pages</strong>.</li>
<li><strong>Pointer Size:</strong> <strong>6 Bytes</strong> on disk (addresses up to 256 TB).</li>
<li><strong>Hardware Alignment:</strong> <strong>8 Bytes</strong> in RAM (64-bit CPU standard).</li>
<li><strong>The Goal:</strong> Maximize <strong>Page Density</strong> to keep the B-Tree as short as possible.</li>
</ol>
<h2 id="18-the-box-in-a-room-analogy-understanding-density">18. The &ldquo;Box in a Room&rdquo; Analogy: Understanding Density<a hidden class="anchor" aria-hidden="true" href="#18-the-box-in-a-room-analogy-understanding-density">#</a></h2>
<p>To visualize how a database index scales, imagine a room that is exactly <strong>8,192 square feet</strong> (our 8 KB Page). Your goal is to fit as many &ldquo;Index Boxes&rdquo; as possible into this room.</p>
<p>Each box consists of two parts:</p>
<ol>
<li><strong>The Value:</strong> The data you are indexing (e.g., an ID or a Name).</li>
<li><strong>The Pointer:</strong> The 6-byte &ldquo;address&rdquo; telling you where the full row lives.</li>
</ol>
<h3 id="scenario-a-the-lean-integer-4-bytes">Scenario A: The Lean Integer (4 Bytes)<a hidden class="anchor" aria-hidden="true" href="#scenario-a-the-lean-integer-4-bytes">#</a></h3>
<ul>
<li><strong>Box Width:</strong> 4B (Value) + 6B (Pointer) = <strong>10 bytes</strong>.</li>
<li><strong>Room Capacity:</strong> $8192 / 10 = \mathbf{819}$ <strong>boxes</strong>.</li>
<li><strong>The Result:</strong> High density. The database can find millions of rows in just 3 &ldquo;jumps.&rdquo;</li>
</ul>
<h3 id="scenario-b-the-bulky-uuid-16-bytes">Scenario B: The Bulky UUID (16 Bytes)<a hidden class="anchor" aria-hidden="true" href="#scenario-b-the-bulky-uuid-16-bytes">#</a></h3>
<p>Many modern systems use UUIDs (Universally Unique Identifiers) because they are great for distributed systems. But they are &ldquo;wide.&rdquo;</p>
<ul>
<li><strong>Box Width:</strong> 16B (Value) + 6B (Pointer) = <strong>22 bytes</strong>.</li>
<li><strong>Room Capacity:</strong> $8192 / 22 \approx \mathbf{372}$ <strong>boxes</strong>.</li>
<li><strong>The Result:</strong> Your capacity has dropped by <strong>over 50%</strong>.</li>
</ul>
<hr>
<h2 id="19-the-multiplier-effect-of-fan-out">19. The &ldquo;Multiplier Effect&rdquo; of Fan-out<a hidden class="anchor" aria-hidden="true" href="#19-the-multiplier-effect-of-fan-out">#</a></h2>
<p>Why does it matter if we have 819 boxes versus 372? It’s because of <strong>Fan-out</strong>. Every &ldquo;box&rdquo; in the Root node points to a whole new page.</p>
<p>Look at how the total capacity of a 2-level tree changes based on box size:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Box Size</th>
          <th style="text-align: left">Pointers per Page</th>
          <th style="text-align: left">Total Rows Found (2 Levels)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>10 Bytes (Integer)</strong></td>
          <td style="text-align: left">819</td>
          <td style="text-align: left">$819 \times 819 = \mathbf{670,761}$</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>22 Bytes (UUID)</strong></td>
          <td style="text-align: left">372</td>
          <td style="text-align: left">$372 \times 372 = \mathbf{138,384}$</td>
      </tr>
  </tbody>
</table>
<p><strong>The Deep Insight:</strong> By choosing a wider data type (like UUID or a long String), your index becomes less efficient. The tree grows <strong>taller</strong>, requiring more &ldquo;jumps&rdquo; to the disk.</p>
<p>In computer time:</p>
<ul>
<li><strong>3 Jumps:</strong> Fast (likely fits in RAM).</li>
<li><strong>5 Jumps:</strong> Slower (requires more trips to the physical SSD).</li>
</ul>
<hr>
<h2 id="20-conclusion-the-deep-planners-rules-for-indexing">20. Conclusion: The Deep Planner&rsquo;s Rules for Indexing<a hidden class="anchor" aria-hidden="true" href="#20-conclusion-the-deep-planners-rules-for-indexing">#</a></h2>
<p>After diving deep into the hardware, the OS, and the math, we can summarize the &ldquo;laws&rdquo; of database performance:</p>
<ol>
<li><strong>The 8 KB Page is Fixed:</strong> Ubuntu always moves 4 KB blocks, and the database always groups them into 8 KB logical units. We cannot change the &ldquo;room&rdquo; size, only how we pack it.</li>
<li><strong>Pointer Size is a Trade-off:</strong> We use <strong>6-byte pointers</strong> instead of <strong>8-byte pointers</strong> to lower the &ldquo;denominator&rdquo; and increase density.</li>
<li><strong>Data Width is King:</strong> Small data types (Integers) make for &ldquo;fat, short&rdquo; trees that are incredibly fast. Large data types (UUIDs, Strings) make for &ldquo;skinny, tall&rdquo; trees that are slower.</li>
<li><strong>Disk is the Bottleneck:</strong> Every design choice—from the 6-byte pointer to the 8 KB page—is made to avoid &ldquo;Disk I/O.&rdquo; Reading from an SSD is <strong>1,000x slower</strong> than reading from RAM.</li>
</ol>
<blockquote>
<p><strong>Final Pro-Tip:</strong> When designing a database, always choose the smallest data type that safely fits your data. You aren&rsquo;t just saving disk space; you are increasing the &ldquo;Fan-out&rdquo; of your index and making your entire application faster.</p>
</blockquote>
<h2 id="21-the-chaos-of-the-page-split">21. The Chaos of the &ldquo;Page Split&rdquo;<a hidden class="anchor" aria-hidden="true" href="#21-the-chaos-of-the-page-split">#</a></h2>
<p>What happens when our 8 KB &ldquo;room&rdquo; is perfectly packed with 819 boxes, and we try to shove one more inside? The database cannot simply &ldquo;push&rdquo; the other boxes; that would be too slow. Instead, it performs a <strong>Page Split</strong>.</p>
<h3 id="how-a-page-split-works">How a Page Split Works:<a hidden class="anchor" aria-hidden="true" href="#how-a-page-split-works">#</a></h3>
<ol>
<li><strong>Allocation:</strong> The DB creates a brand new, empty 8 KB page.</li>
<li><strong>The 50/50 Rule:</strong> It moves the bottom 50% of the entries from the full page into the new page.</li>
<li><strong>Insertion:</strong> It drops the new ID into the now-available space.</li>
<li><strong>The Link:</strong> It updates the &ldquo;Parent&rdquo; node to point to this new child page.</li>
</ol>
<p><strong>The Performance Hit:</strong> While a <code>SELECT</code> only reads data, an <code>INSERT</code> that triggers a split must write <strong>two</strong> new pages to the disk and update the index hierarchy. This is why &ldquo;heavy&rdquo; indexing makes writes slower.</p>
<hr>
<h2 id="22-case-study-the-uuid-performance-trap">22. Case Study: The UUID Performance Trap<a hidden class="anchor" aria-hidden="true" href="#22-case-study-the-uuid-performance-trap">#</a></h2>
<p>If you use <strong>Random UUIDs (v4)</strong> as primary keys in PostgreSQL, you are likely hitting a performance wall. Based on our &ldquo;Deep Planning&rdquo; math, here is why:</p>
<h3 id="1-the-width-problem">1. The &ldquo;Width&rdquo; Problem<a hidden class="anchor" aria-hidden="true" href="#1-the-width-problem">#</a></h3>
<p>A UUID is <strong>16 bytes</strong>, whereas a standard Integer is <strong>4 bytes</strong>.</p>
<ul>
<li><strong>Integer Index:</strong> ~819 entries per page.</li>
<li><strong>UUID Index:</strong> ~372 entries per page.</li>
<li><strong>Result:</strong> Your index is <strong>2x larger</strong> and the tree is <strong>taller</strong>, requiring more Disk I/O.</li>
</ul>
<h3 id="2-the-locality-problem-fragmentation">2. The &ldquo;Locality&rdquo; Problem (Fragmentation)<a hidden class="anchor" aria-hidden="true" href="#2-the-locality-problem-fragmentation">#</a></h3>
<ul>
<li><strong>Sequential IDs (1, 2, 3&hellip;):</strong> These always land at the &ldquo;Right-Hand Edge&rdquo; of the tree. The old pages stay perfectly packed and the DB only works on the last page.</li>
<li><strong>Random UUIDs (A, Z, B&hellip;):</strong> These land in the <strong>middle</strong> of random pages. This triggers constant Page Splits across the entire index, leaving your pages half-empty (fragmented).</li>
</ul>
<h3 id="3-the-ram-exhaustion">3. The RAM Exhaustion<a hidden class="anchor" aria-hidden="true" href="#3-the-ram-exhaustion">#</a></h3>
<p>Because random UUIDs can land anywhere, PostgreSQL must keep the <strong>entire index</strong> in RAM (the Buffer Pool) to stay fast. Once your UUID index grows larger than your available RAM, performance &ldquo;falls off a cliff&rdquo; as every single insert starts requiring a slow Disk Read.</p>
<hr>
<h2 id="23-the-modern-solution-uuid-v7">23. The Modern Solution: UUID v7<a hidden class="anchor" aria-hidden="true" href="#23-the-modern-solution-uuid-v7">#</a></h2>
<p>If you need the uniqueness of a UUID but the speed of an Integer, use <strong>UUID v7</strong>.</p>
<ul>
<li><strong>The Secret:</strong> The first 48 bits of a UUID v7 are a <strong>Timestamp</strong>.</li>
<li><strong>The Benefit:</strong> They are &ldquo;Time-Ordered.&rdquo; To the database, they behave like an Auto-Incrementing Integer, always landing at the end of the index and preventing chaotic Page Splits.</li>
</ul>
<hr>
<h2 id="final-post-summary-the-deep-planners-checklist">Final Post Summary: The Deep Planner&rsquo;s Checklist<a hidden class="anchor" aria-hidden="true" href="#final-post-summary-the-deep-planners-checklist">#</a></h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Feature</th>
          <th style="text-align: left">The Goal</th>
          <th style="text-align: left">The &ldquo;Deep&rdquo; Reason</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Page Size</strong></td>
          <td style="text-align: left">8 KB</td>
          <td style="text-align: left">Matches the OS (2x 4KB) while maximizing pointer density.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Pointer Size</strong></td>
          <td style="text-align: left">6 Bytes</td>
          <td style="text-align: left">Large enough for 256TB, small enough to fit ~20% more data.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Key Type</strong></td>
          <td style="text-align: left">Sequential</td>
          <td style="text-align: left">Prevents <strong>Page Splits</strong> and keeps index pages &ldquo;hot&rdquo; in RAM.</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Data Width</strong></td>
          <td style="text-align: left">Small</td>
          <td style="text-align: left">Maximizes <strong>Fan-out</strong>, keeping the search tree short and fast.</td>
      </tr>
  </tbody>
</table>
<h2 id="24-the-diagnosis-my-postgresql-uses-uuid-v4">24. The Diagnosis: My PostgreSQL uses UUID v4<a hidden class="anchor" aria-hidden="true" href="#24-the-diagnosis-my-postgresql-uses-uuid-v4">#</a></h2>
<p>If you find that your primary keys are <strong>UUID v4</strong>, your database is currently playing a game of &ldquo;Random Roulette&rdquo; with your storage.</p>
<h3 id="the-problem-randomness-vs-the-8-kb-page">The Problem: Randomness vs. The 8 KB Page<a hidden class="anchor" aria-hidden="true" href="#the-problem-randomness-vs-the-8-kb-page">#</a></h3>
<p>Every time you insert a new UUID v4, PostgreSQL picks a random page in your index.</p>
<ul>
<li><strong>If the page is full:</strong> It triggers a <strong>Page Split</strong>, moving 4 KB of data to make room for one 16-byte ID.</li>
<li><strong>If the page is in RAM:</strong> Great!</li>
<li><strong>If the page is on Disk:</strong> The database must &ldquo;seek&rdquo; a random location on your SSD, which is much slower than reading sequential data.</li>
</ul>
<hr>
<h2 id="25-the-solution-transitioning-to-uuid-v7">25. The Solution: Transitioning to UUID v7<a hidden class="anchor" aria-hidden="true" href="#25-the-solution-transitioning-to-uuid-v7">#</a></h2>
<p>You don&rsquo;t need to rebuild your entire database to fix this. You can start &ldquo;healing&rdquo; the index today by switching new inserts to <strong>UUID v7</strong>.</p>
<h3 id="why-uuid-v7-wins">Why UUID v7 Wins<a hidden class="anchor" aria-hidden="true" href="#why-uuid-v7-wins">#</a></h3>
<p>A UUID v7 looks exactly like a v4 (128 bits), but the first 48 bits are a <strong>Timestamp</strong>.</p>
<ul>
<li><strong>To the User:</strong> It looks like a random string.</li>
<li><strong>To the B-Tree:</strong> It behaves like a sequence. Because the timestamps always increase, new IDs always land on the &ldquo;Right-Hand Edge&rdquo; of the tree, filling up the 8 KB pages perfectly and ending the cycle of random Page Splits.</li>
</ul>
<h3 id="step-by-step-implementation-in-postgresql">Step-by-Step Implementation in PostgreSQL<a hidden class="anchor" aria-hidden="true" href="#step-by-step-implementation-in-postgresql">#</a></h3>
<h4 id="1-create-the-generator">1. Create the Generator<a hidden class="anchor" aria-hidden="true" href="#1-create-the-generator">#</a></h4>
<p>Since native support for v7 is coming in PostgreSQL 18, we can use a PL/pgSQL function to generate them now:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">uuid_generate_v7</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">RETURNS</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">DECLARE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">unix_ts_ms</span><span class="w"> </span><span class="n">bytea</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">uuid_bytes</span><span class="w"> </span><span class="n">bytea</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- 1. Get current timestamp in milliseconds (48 bits)
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">unix_ts_ms</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">decode</span><span class="p">(</span><span class="n">lpad</span><span class="p">(</span><span class="n">to_hex</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="k">extract</span><span class="p">(</span><span class="n">epoch</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">clock_timestamp</span><span class="p">())</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">)::</span><span class="nb">bigint</span><span class="p">),</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;hex&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- 2. Generate random bytes for the rest
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">uuid_bytes</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">unix_ts_ms</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">gen_random_bytes</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">-- 3. Set version (7) and variant bits
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">uuid_bytes</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">set_byte</span><span class="p">(</span><span class="n">uuid_bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">get_byte</span><span class="p">(</span><span class="n">uuid_bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">112</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">uuid_bytes</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">set_byte</span><span class="p">(</span><span class="n">uuid_bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">get_byte</span><span class="p">(</span><span class="n">uuid_bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">63</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">128</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">RETURN</span><span class="w"> </span><span class="n">encode</span><span class="p">(</span><span class="n">uuid_bytes</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hex&#39;</span><span class="p">)::</span><span class="n">uuid</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">END</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="err">$$</span><span class="w"> </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="w"> </span><span class="k">VOLATILE</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="26">
<li>The Final Result: A Balanced Ecosystem</li>
</ol>
<p>By understanding the interaction between the 48-bit pointer, the 8 KB Database Page, and the 4 KB OS block, we have moved from a fragmented, slow index to a high-density, sequential one.</p>
<pre><code>Density: We fit the maximum number of entries per page.

Locality: We keep related data physically close on the disk.

Performance: We minimize Disk I/O, ensuring our 64-bit CPU spent more time processing and less time waiting for the &quot;slow&quot; storage.

Final Note: If you want to &quot;clean up&quot; the mess left behind by old UUID v4s, run REINDEX TABLE your_table_name; during a maintenance window. This will repack all those 8 KB pages with maximum density.


## 27. Fixing the Ambiguous Join &amp; Bloat Analysis
</code></pre>
<p>When querying PostgreSQL system catalogs, columns like <code>indexrelid</code> appear in multiple tables. You must use <strong>Aliases</strong> (e.g., <code>s.</code> or <code>i.</code>) to tell Postgres exactly which table to look at.</p>
<h3 id="the-corrected-bloat--density-query">The Corrected Bloat &amp; Density Query<a hidden class="anchor" aria-hidden="true" href="#the-corrected-bloat--density-query">#</a></h3>
<p>Run this to see how your <strong>8 KB pages</strong> are actually performing:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">schemaname</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">relname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tablename</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">indexrelname</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Estimated density: Ratio of used space vs the 8KB page limit
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">round</span><span class="p">((</span><span class="k">c</span><span class="p">.</span><span class="n">reltuples</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8192</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">density_score</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_relation_size</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">indexrelid</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">index_size</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pg_relation_size</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">indexrelid</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8192</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_8kb_pages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_user_indexes</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">JOIN</span><span class="w"> </span><span class="n">pg_class</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">indexrelid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">oid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">JOIN</span><span class="w"> </span><span class="n">pg_index</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">indexrelid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">indexrelid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">WHERE</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">idx_scan</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="mi">28</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="s2">&#34;Heavy Data&#34;</span><span class="w"> </span><span class="n">Reality</span><span class="p">:</span><span class="w"> </span><span class="n">TSVectors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">I</span><span class="w"> </span><span class="n">noticed</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">building</span><span class="w"> </span><span class="n">search_vector</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">to_tsvector</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">adds</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="n">Page</span><span class="w"> </span><span class="n">math</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">The</span><span class="w"> </span><span class="n">Box</span><span class="w"> </span><span class="k">Size</span><span class="p">:</span><span class="w"> </span><span class="n">Our</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">bytes</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">tsvector</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="mi">500</span><span class="o">+</span><span class="w"> </span><span class="n">bytes</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">The</span><span class="w"> </span><span class="n">Denominator</span><span class="p">:</span><span class="w"> </span><span class="k">Instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">fitting</span><span class="w"> </span><span class="mi">819</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="p">(</span><span class="n">GIN</span><span class="w"> </span><span class="k">index</span><span class="p">)</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="mi">10</span><span class="o">-</span><span class="mi">15</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">The</span><span class="w"> </span><span class="n">Performance</span><span class="w"> </span><span class="n">Impact</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">why</span><span class="w"> </span><span class="k">Full</span><span class="o">-</span><span class="nb">Text</span><span class="w"> </span><span class="k">Search</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="s2">&#34;heavy.&#34;</span><span class="w"> </span><span class="k">Every</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">decompress</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="k">large</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Disk</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">fetch</span><span class="w"> </span><span class="n">much</span><span class="w"> </span><span class="n">larger</span><span class="w"> </span><span class="n">pages</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="mi">29</span><span class="p">.</span><span class="w"> </span><span class="k">Final</span><span class="w"> </span><span class="k">Implementation</span><span class="w"> </span><span class="n">Checklist</span><span class="w"> </span><span class="p">(</span><span class="n">Postgres</span><span class="w"> </span><span class="mi">17</span><span class="p">.</span><span class="mi">7</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Now</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">pgcrypto</span><span class="w"> </span><span class="n">installed</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">tested</span><span class="p">,</span><span class="w"> </span><span class="n">follow</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">steps</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">agent</span><span class="p">,</span><span class="w"> </span><span class="k">user</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">standard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Step</span><span class="p">,</span><span class="n">Action</span><span class="p">,</span><span class="k">SQL</span><span class="w"> </span><span class="n">Command</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="p">,</span><span class="n">Apply</span><span class="w"> </span><span class="k">Default</span><span class="p">,</span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">generate_uuid_v7</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="p">,</span><span class="n">Apply</span><span class="w"> </span><span class="k">Default</span><span class="p">,</span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">generate_uuid_v7</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="p">,</span><span class="n">Repack</span><span class="w"> </span><span class="n">Pages</span><span class="p">,</span><span class="k">REINDEX</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">agent</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="p">,</span><span class="n">Verify</span><span class="p">,</span><span class="n">Run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Density</span><span class="w"> </span><span class="n">Query</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">move</span><span class="w"> </span><span class="n">closer</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">9</span><span class="o">+</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="o">##</span><span class="w"> </span><span class="mi">30</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="s2">&#34;Smoking Gun&#34;</span><span class="p">:</span><span class="w"> </span><span class="n">Analyzing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">08</span><span class="o">%</span><span class="w"> </span><span class="n">Density</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">The</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">provided</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">pgstatindex</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">avg_leaf_density</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">08</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ultimate</span><span class="w"> </span><span class="n">proof</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">**</span><span class="n">UUID</span><span class="w"> </span><span class="n">v4</span><span class="o">**</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">###</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Math</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">08</span><span class="o">%</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Page</span><span class="w"> </span><span class="k">Size</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="mi">192</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Used</span><span class="w"> </span><span class="k">Space</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="err">$</span><span class="mi">8192</span><span class="w"> </span><span class="err">\</span><span class="n">times</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0108</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">mathbf</span><span class="err">{</span><span class="mi">88</span><span class="p">.</span><span class="mi">47</span><span class="w"> </span><span class="err">\</span><span class="nb">text</span><span class="err">{</span><span class="w"> </span><span class="n">bytes</span><span class="err">}}$</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Wasted</span><span class="w"> </span><span class="k">Space</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="o">**</span><span class="mi">8</span><span class="p">,</span><span class="mi">103</span><span class="w"> </span><span class="n">bytes</span><span class="o">**</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Because</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">UUIDs</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w"> </span><span class="n">had</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="o">**</span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="n">page</span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="s2">&#34;warehouse&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">parked</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="mi">88</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="p">(</span><span class="n">roughly</span><span class="w"> </span><span class="mi">5</span><span class="o">-</span><span class="mi">6</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="n">Because</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="n">land</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">forcing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">open</span><span class="w"> </span><span class="n">yet</span><span class="w"> </span><span class="o">*</span><span class="n">another</span><span class="o">*</span><span class="w"> </span><span class="n">mostly</span><span class="o">-</span><span class="n">empty</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">---
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">##</span><span class="w"> </span><span class="mi">31</span><span class="p">.</span><span class="w"> </span><span class="n">Correcting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Correlation</span><span class="w"> </span><span class="n">Query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">You</span><span class="w"> </span><span class="n">attempted</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">**</span><span class="n">Correlation</span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="n">how</span><span class="w"> </span><span class="n">closely</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">physical</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">order</span><span class="p">).</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">vital</span><span class="w"> </span><span class="s2">&#34;Deep Planner&#34;</span><span class="w"> </span><span class="n">metric</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Your</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="o">`</span><span class="k">public</span><span class="p">.</span><span class="n">organisation</span><span class="o">`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">`</span><span class="n">tablename</span><span class="o">`</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">`</span><span class="n">pg_stats</span><span class="o">`</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="k">prefix</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">###</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Corrected</span><span class="w"> </span><span class="k">SQL</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">```</span><span class="k">sql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tablename</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">attname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">column_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">correlation</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stats</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="k">WHERE</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;organisation&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="k">AND</span><span class="w"> </span><span class="n">schemaname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;public&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">Gemini</span><span class="w"> </span><span class="n">said</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Here</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">breakdown</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">Organisation</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">corrected</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="n">them</span><span class="p">,</span><span class="w"> </span><span class="n">formatted</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">technical</span><span class="w"> </span><span class="n">records</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Markdown</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">##</span><span class="w"> </span><span class="mi">30</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="s2">&#34;Smoking Gun&#34;</span><span class="p">:</span><span class="w"> </span><span class="n">Analyzing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">08</span><span class="o">%</span><span class="w"> </span><span class="n">Density</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">The</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">provided</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">pgstatindex</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">avg_leaf_density</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">08</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ultimate</span><span class="w"> </span><span class="n">proof</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">**</span><span class="n">UUID</span><span class="w"> </span><span class="n">v4</span><span class="o">**</span><span class="w"> </span><span class="n">problem</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">###</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Math</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">08</span><span class="o">%</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Page</span><span class="w"> </span><span class="k">Size</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="mi">192</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Used</span><span class="w"> </span><span class="k">Space</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="err">$</span><span class="mi">8192</span><span class="w"> </span><span class="err">\</span><span class="n">times</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0108</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="n">mathbf</span><span class="err">{</span><span class="mi">88</span><span class="p">.</span><span class="mi">47</span><span class="w"> </span><span class="err">\</span><span class="nb">text</span><span class="err">{</span><span class="w"> </span><span class="n">bytes</span><span class="err">}}$</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Wasted</span><span class="w"> </span><span class="k">Space</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="o">**</span><span class="mi">8</span><span class="p">,</span><span class="mi">103</span><span class="w"> </span><span class="n">bytes</span><span class="o">**</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Because</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">UUIDs</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w"> </span><span class="n">had</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="o">**</span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="n">page</span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="s2">&#34;warehouse&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">parked</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="mi">88</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="p">(</span><span class="n">roughly</span><span class="w"> </span><span class="mi">5</span><span class="o">-</span><span class="mi">6</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="n">Because</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">random</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="n">land</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">forcing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">open</span><span class="w"> </span><span class="n">yet</span><span class="w"> </span><span class="o">*</span><span class="n">another</span><span class="o">*</span><span class="w"> </span><span class="n">mostly</span><span class="o">-</span><span class="n">empty</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">---
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">##</span><span class="w"> </span><span class="mi">31</span><span class="p">.</span><span class="w"> </span><span class="n">Correcting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Correlation</span><span class="w"> </span><span class="n">Query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">You</span><span class="w"> </span><span class="n">attempted</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">**</span><span class="n">Correlation</span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="n">how</span><span class="w"> </span><span class="n">closely</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">physical</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">order</span><span class="p">).</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">vital</span><span class="w"> </span><span class="s2">&#34;Deep Planner&#34;</span><span class="w"> </span><span class="n">metric</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Your</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="o">`</span><span class="k">public</span><span class="p">.</span><span class="n">organisation</span><span class="o">`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">`</span><span class="n">tablename</span><span class="o">`</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">`</span><span class="n">pg_stats</span><span class="o">`</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="k">prefix</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">###</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Corrected</span><span class="w"> </span><span class="k">SQL</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">```</span><span class="k">sql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tablename</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">attname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">column_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">correlation</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stats</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="k">WHERE</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;organisation&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="k">AND</span><span class="w"> </span><span class="n">schemaname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;public&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">How</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">interpret</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">&#34;Correlation&#34;</span><span class="w"> </span><span class="k">result</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Near</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">Perfectly</span><span class="w"> </span><span class="n">ordered</span><span class="w"> </span><span class="p">(</span><span class="n">Sequential</span><span class="p">).</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="n">Integers</span><span class="p">).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Near</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">Totally</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="p">(</span><span class="n">Chaos</span><span class="p">).</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">happens</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">v4</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Near</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">Perfectly</span><span class="w"> </span><span class="n">ordered</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">reverse</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">32</span><span class="p">.</span><span class="w"> </span><span class="k">Final</span><span class="w"> </span><span class="n">Comparison</span><span class="p">:</span><span class="w"> </span><span class="n">Topic</span><span class="w"> </span><span class="n">vs</span><span class="p">.</span><span class="w"> </span><span class="n">Organisation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Feature</span><span class="w">	</span><span class="n">topic</span><span class="w"> </span><span class="k">table</span><span class="w">	</span><span class="n">organisation</span><span class="w"> </span><span class="k">table</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">ID</span><span class="w"> </span><span class="k">Type</span><span class="w">	</span><span class="nb">Integer</span><span class="w"> </span><span class="p">(</span><span class="nb">Serial</span><span class="p">)</span><span class="w">	</span><span class="n">UUID</span><span class="w"> </span><span class="n">v4</span><span class="w"> </span><span class="p">(</span><span class="n">Random</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="mi">8</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="n">Strategy</span><span class="w">	</span><span class="n">Sequential</span><span class="p">:</span><span class="w"> </span><span class="n">Fills</span><span class="w"> </span><span class="n">pages</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="n">perfectly</span><span class="p">.</span><span class="w">	</span><span class="n">Random</span><span class="p">:</span><span class="w"> </span><span class="n">Scatters</span><span class="w"> </span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">leaving</span><span class="w"> </span><span class="n">pages</span><span class="w"> </span><span class="mi">99</span><span class="o">%</span><span class="w"> </span><span class="n">empty</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Density</span><span class="w"> </span><span class="n">Score</span><span class="w">	</span><span class="mi">9</span><span class="p">.</span><span class="mi">62</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">Low</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">it</span><span class="s1">&#39;s new)	1.08% (Dangerously low)
</span></span></span><span class="line"><span class="cl"><span class="s1">Action Taken	None needed.	Switched to UUID v7.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">The &#34;Deep Planner&#34; Result
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">By switching the organisation table to generate_uuid_v7(), you are ensuring that as your company grows, the correlation score will move toward 1.0 and the density_score will move toward 90%+. You have successfully optimized the &#34;DNA&#34; of your primary storage.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">## 33. Understanding the &#34;High Bloat&#34; Alarm
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">When you run a bloat query on a small or brand-new database, you will often see **&#34;HIGH BLOAT&#34;** warnings across every table. While the term sounds scary, for your current setup, it is a mathematical illusion.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">### The &#34;Empty Parking Garage&#34; Effect
</span></span></span><span class="line"><span class="cl"><span class="s1">Look at your `index_size` column. Most of your indexes are exactly **16 KB**.
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Page 1 (8 KB):** The Metapage (stores index version and internal rules).
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Page 2 (8 KB):** The Leaf Page (where your actual IDs live).
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">Because you only have a few rows of data, you are only using a few bytes of that second 8 KB page. 
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Calculation:** If you have 5 rows (approx. 100 bytes) in an 8,192-byte page, your density is **1.2%**.
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Result:** The query flags this as &#34;High Bloat&#34; because the &#34;room&#34; is 99% empty.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">---
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">## 34. Current Index Health Report
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">| Table Name | Index Name | Size | Density | Status | Deep Planner Verdict |
</span></span></span><span class="line"><span class="cl"><span class="s1">| :--- | :--- | :--- | :--- | :--- | :--- |
</span></span></span><span class="line"><span class="cl"><span class="s1">| **organisation** | `PK_c725...` | 16 KB | ~1.08% | HIGH BLOAT | **Healthy.** Just needs more rows to fill the page. |
</span></span></span><span class="line"><span class="cl"><span class="s1">| **topic** | `topic_id_seq` | 16 KB | ~9.62% | HIGH BLOAT | **Healthy.** Since it&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="nb">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">perfectly</span><span class="p">.</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">|</span><span class="w"> </span><span class="o">**</span><span class="n">agent</span><span class="o">**</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">`</span><span class="n">PK_</span><span class="p">...</span><span class="o">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Low</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">HIGH</span><span class="w"> </span><span class="n">BLOAT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">**</span><span class="n">Action</span><span class="w"> </span><span class="n">Needed</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="n">Apply</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">v7</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">###</span><span class="w"> </span><span class="k">When</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="s2">&#34;High Bloat&#34;</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">become</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">problem</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Bloat</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">matters</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">**</span><span class="k">Large</span><span class="w"> </span><span class="p">(</span><span class="n">MBs</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">GBs</span><span class="p">)</span><span class="o">**</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Small</span><span class="w"> </span><span class="k">Index</span><span class="w"> </span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="n">KB</span><span class="p">):</span><span class="o">**</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">density</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">fine</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">new</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="k">Large</span><span class="w"> </span><span class="k">Index</span><span class="w"> </span><span class="p">(</span><span class="mi">500</span><span class="w"> </span><span class="n">MB</span><span class="p">):</span><span class="o">**</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">density</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">wasting</span><span class="w"> </span><span class="mi">495</span><span class="w"> </span><span class="n">MB</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="s2">&#34;empty air.&#34;</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">`</span><span class="k">REINDEX</span><span class="o">`</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">---
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">##</span><span class="w"> </span><span class="mi">35</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="s2">&#34;Search Vector&#34;</span><span class="w"> </span><span class="n">Performance</span><span class="w"> </span><span class="k">Check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">I</span><span class="w"> </span><span class="n">noticed</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="o">`</span><span class="n">topic</span><span class="o">`</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">KB</span><span class="p">.</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="o">`</span><span class="k">UPDATE</span><span class="o">`</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">`</span><span class="n">search_vector</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">hasn</span><span class="s1">&#39;t grown. This is good! It means:
</span></span></span><span class="line"><span class="cl"><span class="s1">1.  Your `search_vector` data is relatively small.
</span></span></span><span class="line"><span class="cl"><span class="s1">2.  PostgreSQL&#39;</span><span class="n">s</span><span class="w"> </span><span class="o">**</span><span class="n">Auto</span><span class="o">-</span><span class="k">Vacuum</span><span class="o">**</span><span class="w"> </span><span class="n">hasn</span><span class="s1">&#39;t needed to create massive new pages yet.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">### Final Verification Query
</span></span></span><span class="line"><span class="cl"><span class="s1">To see how the `search_vector` specifically is affecting your **Table Density** (not just the index), run this:
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">```sql
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT 
</span></span></span><span class="line"><span class="cl"><span class="s1">    relname AS table_name, 
</span></span></span><span class="line"><span class="cl"><span class="s1">    pg_size_pretty(pg_total_relation_size(relid)) AS total_size,
</span></span></span><span class="line"><span class="cl"><span class="s1">    pg_size_pretty(pg_table_size(relid)) AS data_size,
</span></span></span><span class="line"><span class="cl"><span class="s1">    pg_size_pretty(pg_indexes_size(relid)) AS index_size
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM pg_stat_user_tables 
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE relname = &#39;</span><span class="n">topic</span><span class="s1">&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1"> Gemini said
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">Here is the breakdown of your Index Bloat report, formatted for your technical records.
</span></span></span><span class="line"><span class="cl"><span class="s1">Markdown
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">## 33. Understanding the &#34;High Bloat&#34; Alarm
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">When you run a bloat query on a small or brand-new database, you will often see **&#34;HIGH BLOAT&#34;** warnings across every table. While the term sounds scary, for your current setup, it is a mathematical illusion.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">### The &#34;Empty Parking Garage&#34; Effect
</span></span></span><span class="line"><span class="cl"><span class="s1">Look at your `index_size` column. Most of your indexes are exactly **16 KB**.
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Page 1 (8 KB):** The Metapage (stores index version and internal rules).
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Page 2 (8 KB):** The Leaf Page (where your actual IDs live).
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">Because you only have a few rows of data, you are only using a few bytes of that second 8 KB page. 
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Calculation:** If you have 5 rows (approx. 100 bytes) in an 8,192-byte page, your density is **1.2%**.
</span></span></span><span class="line"><span class="cl"><span class="s1">* **Result:** The query flags this as &#34;High Bloat&#34; because the &#34;room&#34; is 99% empty.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">---
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">## 34. Current Index Health Report
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">| Table Name | Index Name | Size | Density | Status | Deep Planner Verdict |
</span></span></span><span class="line"><span class="cl"><span class="s1">| :--- | :--- | :--- | :--- | :--- | :--- |
</span></span></span><span class="line"><span class="cl"><span class="s1">| **organisation** | `PK_c725...` | 16 KB | ~1.08% | HIGH BLOAT | **Healthy.** Just needs more rows to fill the page. |
</span></span></span><span class="line"><span class="cl"><span class="s1">| **topic** | `topic_id_seq` | 16 KB | ~9.62% | HIGH BLOAT | **Healthy.** Since it&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="nb">Integer</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">perfectly</span><span class="p">.</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">|</span><span class="w"> </span><span class="o">**</span><span class="n">agent</span><span class="o">**</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">`</span><span class="n">PK_</span><span class="p">...</span><span class="o">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Low</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">HIGH</span><span class="w"> </span><span class="n">BLOAT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">**</span><span class="n">Action</span><span class="w"> </span><span class="n">Needed</span><span class="p">:</span><span class="o">**</span><span class="w"> </span><span class="n">Apply</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">v7</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">###</span><span class="w"> </span><span class="k">When</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="s2">&#34;High Bloat&#34;</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">become</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">problem</span><span class="o">?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">Bloat</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">matters</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">**</span><span class="k">Large</span><span class="w"> </span><span class="p">(</span><span class="n">MBs</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">GBs</span><span class="p">)</span><span class="o">**</span><span class="p">.</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="n">Small</span><span class="w"> </span><span class="k">Index</span><span class="w"> </span><span class="p">(</span><span class="mi">16</span><span class="w"> </span><span class="n">KB</span><span class="p">):</span><span class="o">**</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">density</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">fine</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">new</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">*</span><span class="w"> </span><span class="o">**</span><span class="k">Large</span><span class="w"> </span><span class="k">Index</span><span class="w"> </span><span class="p">(</span><span class="mi">500</span><span class="w"> </span><span class="n">MB</span><span class="p">):</span><span class="o">**</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">density</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="o">%</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">wasting</span><span class="w"> </span><span class="mi">495</span><span class="w"> </span><span class="n">MB</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">RAM</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="s2">&#34;empty air.&#34;</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">`</span><span class="k">REINDEX</span><span class="o">`</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">---
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="o">##</span><span class="w"> </span><span class="mi">35</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="s2">&#34;Search Vector&#34;</span><span class="w"> </span><span class="n">Performance</span><span class="w"> </span><span class="k">Check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="n">I</span><span class="w"> </span><span class="n">noticed</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="o">`</span><span class="n">topic</span><span class="o">`</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="n">KB</span><span class="p">.</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="o">`</span><span class="k">UPDATE</span><span class="o">`</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">`</span><span class="n">search_vector</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">hasn</span><span class="s1">&#39;t grown. This is good! It means:
</span></span></span><span class="line"><span class="cl"><span class="s1">1.  Your `search_vector` data is relatively small.
</span></span></span><span class="line"><span class="cl"><span class="s1">2.  PostgreSQL&#39;</span><span class="n">s</span><span class="w"> </span><span class="o">**</span><span class="n">Auto</span><span class="o">-</span><span class="k">Vacuum</span><span class="o">**</span><span class="w"> </span><span class="n">hasn</span><span class="s1">&#39;t needed to create massive new pages yet.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">### Final Verification Query
</span></span></span><span class="line"><span class="cl"><span class="s1">To see how the `search_vector` specifically is affecting your **Table Density** (not just the index), run this:
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">```sql
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT 
</span></span></span><span class="line"><span class="cl"><span class="s1">    relname AS table_name, 
</span></span></span><span class="line"><span class="cl"><span class="s1">    pg_size_pretty(pg_total_relation_size(relid)) AS total_size,
</span></span></span><span class="line"><span class="cl"><span class="s1">    pg_size_pretty(pg_table_size(relid)) AS data_size,
</span></span></span><span class="line"><span class="cl"><span class="s1">    pg_size_pretty(pg_indexes_size(relid)) AS index_size
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM pg_stat_user_tables 
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE relname = &#39;</span><span class="n">topic</span><span class="s1">&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">Summary of your &#34;Deep Plan&#34; Progress
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">You have successfully:
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    Diagnosed the UUID v4 fragmentation.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    Implemented the UUID v7 generator for time-sorted IDs.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    Clustered your organisation table to reclaim empty space.
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    Audited your index health to establish a performance baseline.
</span></span></span><span class="line"><span class="cl"><span class="s1">    
</span></span></span><span class="line"><span class="cl"><span class="s1">    
</span></span></span><span class="line"><span class="cl"><span class="s1">    
</span></span></span><span class="line"><span class="cl"><span class="s1">    ---
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">**Your database is now &#34;tuned&#34; for growth.** Since we have secured the IDs and the B-Tree density, would you like to explore **GIN Indexes** (specifically for your `search_vector`) to see how they differ from standard B-Trees?
</span></span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/databases/">Databases</a></li>
      <li><a href="http://localhost:1313/tags/performance/">Performance</a></li>
      <li><a href="http://localhost:1313/tags/computer-science/">Computer Science</a></li>
    </ul>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Deep Dive: How Database Indexing Works (The B-Tree) on x"
            href="https://x.com/intent/tweet/?text=Deep%20Dive%3a%20How%20Database%20Indexing%20Works%20%28The%20B-Tree%29&amp;url=http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f&amp;hashtags=Databases%2cPerformance%2cComputerScience">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Deep Dive: How Database Indexing Works (The B-Tree) on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f&amp;title=Deep%20Dive%3a%20How%20Database%20Indexing%20Works%20%28The%20B-Tree%29&amp;summary=Deep%20Dive%3a%20How%20Database%20Indexing%20Works%20%28The%20B-Tree%29&amp;source=http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Deep Dive: How Database Indexing Works (The B-Tree) on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f&title=Deep%20Dive%3a%20How%20Database%20Indexing%20Works%20%28The%20B-Tree%29">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Deep Dive: How Database Indexing Works (The B-Tree) on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Deep Dive: How Database Indexing Works (The B-Tree) on whatsapp"
            href="https://api.whatsapp.com/send?text=Deep%20Dive%3a%20How%20Database%20Indexing%20Works%20%28The%20B-Tree%29%20-%20http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Deep Dive: How Database Indexing Works (The B-Tree) on telegram"
            href="https://telegram.me/share/url?text=Deep%20Dive%3a%20How%20Database%20Indexing%20Works%20%28The%20B-Tree%29&amp;url=http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Deep Dive: How Database Indexing Works (The B-Tree) on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Deep%20Dive%3a%20How%20Database%20Indexing%20Works%20%28The%20B-Tree%29&u=http%3a%2f%2flocalhost%3a1313%2fdrafts%2fpostgres-internals-and-visuals%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer><script src="https://giscus.app/client.js"
        data-repo="srajesh2712/srajesh2712.github.io"
        data-repo-id="R_kgDOOWPLLQ"
        data-category="General"
        data-category-id="DIC_kwDOOWPLLc4C2-RG"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Beyond the Bytes</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const zoom = mediumZoom('.post-content img:not(.cover-image)', {
            margin: 24,
            background: 'var(--theme)',
            scrollOffset: 0,
        });
    });
</script>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
